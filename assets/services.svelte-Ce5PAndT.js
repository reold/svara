import{P as a}from"./index-vMURVn30.js";const u="https://svara-integrations.vercel.app",d=`${u}/api/proxy?url=`,p=async(e,t=null)=>{let r=await fetch(e,t?{body:t,method:"POST"}:{method:"GET"}),n=await r.json();if(r.status!=200)throw Error("something went wrong");return n},m={cookieExtractor:(e,t)=>{var i,c;if(!e)return null;const n=e.split(/,(?=\s*\w+=)/).reverse().find(l=>l.trim().startsWith(`${t}=`));return((c=(i=n==null?void 0:n.split(";")[0])==null?void 0:i.split("=")[1])==null?void 0:c.trim())||null}},o={proxy:d,host:"",headers:{Host:"www.saavn.com",Accept:"*/*","User-Agent":"Mozilla/5.0 (Linux; Android 10; K) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/134.0.0.0 Mobile Safari/537.36",Connection:"keep-alive",Cookie:"ssid=did_v1_79D9162F-4F77-4B42-8D86-5EC214467860.1741341828.67317; _pl=iphoneapp-"},auth:{validateEmail:async e=>(await p(`${o.host}${encodeURIComponent(`?_format=json&ctx=iphoneapp&api_version=4&__call=user.isRegisteredEmail&email=${e}`)}`,JSON.stringify({headers:o.headers,method:"GET"}))).status,requestOTP:async(e,t)=>{let r=await p(`${o.host}${encodeURIComponent("?app_version=9.16.1&v=1003&device_type=iPhone_15&_marker=false&_format=json&ctx=iphoneapp&api_version=4&dolby_support=true&is_jio_user=false&r_device=false&network_type=WIFI&network_subtype=wifi&cc=91&__call=user.login")}`,JSON.stringify({headers:{"Content-Type":"application/x-www-form-urlencoded",...o.headers},method:"POST",body:new URLSearchParams({username:e,password:t,user_exist:"True"}).toString()}));return r.status&&r.status=="success"},validateOTP:async(e,t)=>{let r=await fetch(`${o.host}${encodeURIComponent("?app_version=9.16.1&v=1003&device_type=iPhone_15&_marker=false&_format=json&ctx=iphoneapp&api_version=4&dolby_support=true&is_jio_user=false&r_device=false&network_type=WIFI&network_subtype=wifi&cc=91&__call=user.validateOTP")}`,{method:"POST",body:JSON.stringify({headers:{"Content-Type":"application/x-www-form-urlencoded",...o.headers},method:"POST",body:new URLSearchParams({username:e,otp:t}).toString()})}),n=await r.json(),i=m.cookieExtractor(r.headers.get("x-sscookies"),"I");return{...n,sessionToken:i?decodeURIComponent(i):null}}}};o.host=`${o.proxy}${encodeURIComponent("https://www.jiosaavn.com/api.php")}`;const s={playback:{heartbeatInterval:null,startHeartbeat:()=>{a.initiator&&(s.playback.heartbeatInterval=window.setInterval(()=>{if(!a.jam.active||a.connections.size===0)return;const e=Date.now();e-a.jam.lastHeartbeat<5e3||(a.jam.lastHeartbeat=e,a.connections.forEach(t=>{t.send({messageType:"heartbeat",currentTime:a.jam.currentTime,playing:a.jam.playing,currentTrackIndex:a.jam.currentTrackIndex})}))},5e3))},stopHeartbeat:()=>{s.playback.heartbeatInterval!==null&&(clearInterval(s.playback.heartbeatInterval),s.playback.heartbeatInterval=null)},broadcastPlayback:e=>{if(!a.jam.active||a.jam.isSyncing)return;const t=Date.now();if(!["play","pause","queue_update"].includes(e.type)&&t-a.jam.lastBroadcast<1e3)return;const n={messageType:"playback",subtype:e.type,queue:e.queue,currentTrackIndex:e.currentTrackIndex,currentTime:e.currentTime,duration:e.duration,playing:e.playing,initiatedBy:e.initiatedBy||a.user.id};console.log("[p2pServices] Broadcasting:",e.type,"to",a.connections.size,"peers"),a.jam.lastBroadcast=t,a.connections.forEach(i=>{i.send(n)})},broadcastTrackChange:(e,t,r)=>{a.jam.active&&s.playback.broadcastPlayback({type:"play",queue:a.jam.queue,currentTrackIndex:t,duration:r,playing:!0})},broadcastPause:()=>{a.jam.active&&s.playback.broadcastPlayback({type:"pause",playing:!1})},broadcastResume:()=>{a.jam.active&&s.playback.broadcastPlayback({type:"play",playing:!0})},broadcastSeek:e=>{a.jam.active&&s.playback.broadcastPlayback({type:"seek",currentTime:e})},broadcastQueueUpdate:e=>{a.jam.active&&(a.jam.queue=e,s.playback.broadcastPlayback({type:"queue_update",queue:e}))}}};export{d as P,p as d,o as m,s as p};
