const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Search-CXbQjmus.js","assets/index-vMURVn30.js","assets/index-BHMVpPEr.css","assets/input-QVxv62AN.js","assets/source.svelte-ilpGIhIP.js","assets/ShapesSolid-dru5X_nM.js","assets/services.svelte-Ce5PAndT.js","assets/svelte-head-Cnxyuz5S.js","assets/Sheet-yVx4Komk.js","assets/ssh-Dd9KgggB.js","assets/legacy-Bufrj_iA.js","assets/Library-BRgjLK7T.js","assets/Settings-Difb9jFR.js"])))=>i.map(i=>d[i]);
var gn=Object.defineProperty;var er=n=>{throw TypeError(n)};var vn=(n,e,t)=>e in n?gn(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var tr=(n,e,t)=>vn(n,typeof e!="symbol"?e+"":e,t),Et=(n,e,t)=>e.has(n)||er("Cannot "+t);var Ce=(n,e,t)=>(Et(n,e,"read from private field"),t?t.call(n):e.get(n)),xe=(n,e,t)=>e.has(n)?er("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),wt=(n,e,t,r)=>(Et(n,e,"write to private field"),r?r.call(n,t):e.set(n,t),t),rr=(n,e,t)=>(Et(n,e,"access private method"),t);import{k as bn,u as $,m as yn,n as _n,o as je,r as kn,q as nr,l as b,t as Cn,v as xn,w as Te,P as I,b as Ne,p as gt,j as we,h as he,x as vt,a as Fe,f as z,y as Z,g as k,s as C,e as E,z as We,c as me,A as re,B as ce,C as qe,D as ve,E as nt,F as st,i as vr,G as Ve,d as He,H as it,I as Ct,J as Ie,K as F,L as At,M as xt,V as te,N as Mt,O as le,Q as Sn,R as Pe,T as Ge,U as ct,W as at,X as Tn,_ as It,Y as Rn,Z as Pn,a0 as Re,a1 as En,$ as wn}from"./index-vMURVn30.js";import{h as Mn}from"./svelte-head-Cnxyuz5S.js";import{b as lt}from"./input-QVxv62AN.js";import{S as In}from"./Sheet-yVx4Komk.js";import{g as br,f as Dn}from"./ssh-Dd9KgggB.js";import{p as Se}from"./services.svelte-Ce5PAndT.js";import{C as sr,S as ir}from"./ShapesSolid-dru5X_nM.js";import"./legacy-Bufrj_iA.js";function jn(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in n)){const o=Object.getOwnPropertyDescriptor(r,s);o&&Object.defineProperty(n,s,o.get?o:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}var Ee,Be,rt,_t,yr;const kt=class kt{constructor(e){xe(this,_t);xe(this,Ee,new WeakMap);xe(this,Be);xe(this,rt);wt(this,rt,e)}observe(e,t){var r=Ce(this,Ee).get(e)||new Set;return r.add(t),Ce(this,Ee).set(e,r),rr(this,_t,yr).call(this).observe(e,Ce(this,rt)),()=>{var s=Ce(this,Ee).get(e);s.delete(t),s.size===0&&(Ce(this,Ee).delete(e),Ce(this,Be).unobserve(e))}}};Ee=new WeakMap,Be=new WeakMap,rt=new WeakMap,_t=new WeakSet,yr=function(){return Ce(this,Be)??wt(this,Be,new ResizeObserver(e=>{for(var t of e){kt.entries.set(t.target,t);for(var r of Ce(this,Ee).get(t.target)||[])r(t)}}))},tr(kt,"entries",new WeakMap);let Ot=kt;var Ln=new Ot({box:"border-box"});function An(n,e,t){var r=Ln.observe(n,()=>t(n[e]));bn(()=>($(()=>t(n[e])),r))}function On(n=!1){const e=yn,t=e.l.u;if(!t)return;let r=()=>Cn(e.s);if(n){let s=0,o={};const a=xn(()=>{let l=!1;const c=e.s;for(const d in c)c[d]!==o[d]&&(o[d]=c[d],l=!0);return l&&s++,s});r=()=>b(a)}t.b.length&&_n(()=>{ar(e,r),nr(t.b)}),je(()=>{const s=$(()=>t.m.map(kn));return()=>{for(const o of s)typeof o=="function"&&o()}}),t.a.length&&je(()=>{ar(e,r),nr(t.a)})}function ar(n,e){if(n.l.s)for(const t of n.l.s)b(t);e()}class $n{constructor(){this.encoder=new TextEncoder,this._pieces=[],this._parts=[]}append_buffer(e){this.flush(),this._parts.push(e)}append(e){this._pieces.push(e)}flush(){if(this._pieces.length>0){const e=new Uint8Array(this._pieces);this._parts.push(e),this._pieces=[]}}toArrayBuffer(){const e=[];for(const t of this._parts)e.push(t);return zn(e).buffer}}function zn(n){let e=0;for(const s of n)e+=s.byteLength;const t=new Uint8Array(e);let r=0;for(const s of n){const o=new Uint8Array(s.buffer,s.byteOffset,s.byteLength);t.set(o,r),r+=s.byteLength}return t}function _r(n){return new Bn(n).unpack()}function kr(n){const e=new qn,t=e.pack(n);return t instanceof Promise?t.then(()=>e.getBuffer()):e.getBuffer()}class Bn{constructor(e){this.index=0,this.dataBuffer=e,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}unpack(){const e=this.unpack_uint8();if(e<128)return e;if((e^224)<32)return(e^224)-32;let t;if((t=e^160)<=15)return this.unpack_raw(t);if((t=e^176)<=15)return this.unpack_string(t);if((t=e^144)<=15)return this.unpack_array(t);if((t=e^128)<=15)return this.unpack_map(t);switch(e){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return;case 213:return;case 214:return;case 215:return;case 216:return t=this.unpack_uint16(),this.unpack_string(t);case 217:return t=this.unpack_uint32(),this.unpack_string(t);case 218:return t=this.unpack_uint16(),this.unpack_raw(t);case 219:return t=this.unpack_uint32(),this.unpack_raw(t);case 220:return t=this.unpack_uint16(),this.unpack_array(t);case 221:return t=this.unpack_uint32(),this.unpack_array(t);case 222:return t=this.unpack_uint16(),this.unpack_map(t);case 223:return t=this.unpack_uint32(),this.unpack_map(t)}}unpack_uint8(){const e=this.dataView[this.index]&255;return this.index++,e}unpack_uint16(){const e=this.read(2),t=(e[0]&255)*256+(e[1]&255);return this.index+=2,t}unpack_uint32(){const e=this.read(4),t=((e[0]*256+e[1])*256+e[2])*256+e[3];return this.index+=4,t}unpack_uint64(){const e=this.read(8),t=((((((e[0]*256+e[1])*256+e[2])*256+e[3])*256+e[4])*256+e[5])*256+e[6])*256+e[7];return this.index+=8,t}unpack_int8(){const e=this.unpack_uint8();return e<128?e:e-256}unpack_int16(){const e=this.unpack_uint16();return e<32768?e:e-65536}unpack_int32(){const e=this.unpack_uint32();return e<2**31?e:e-2**32}unpack_int64(){const e=this.unpack_uint64();return e<2**63?e:e-2**64}unpack_raw(e){if(this.length<this.index+e)throw new Error(`BinaryPackFailure: index is out of range ${this.index} ${e} ${this.length}`);const t=this.dataBuffer.slice(this.index,this.index+e);return this.index+=e,t}unpack_string(e){const t=this.read(e);let r=0,s="",o,a;for(;r<e;)o=t[r],o<160?(a=o,r++):(o^192)<32?(a=(o&31)<<6|t[r+1]&63,r+=2):(o^224)<16?(a=(o&15)<<12|(t[r+1]&63)<<6|t[r+2]&63,r+=3):(a=(o&7)<<18|(t[r+1]&63)<<12|(t[r+2]&63)<<6|t[r+3]&63,r+=4),s+=String.fromCodePoint(a);return this.index+=e,s}unpack_array(e){const t=new Array(e);for(let r=0;r<e;r++)t[r]=this.unpack();return t}unpack_map(e){const t={};for(let r=0;r<e;r++){const s=this.unpack();t[s]=this.unpack()}return t}unpack_float(){const e=this.unpack_uint32(),t=e>>31,r=(e>>23&255)-127,s=e&8388607|8388608;return(t===0?1:-1)*s*2**(r-23)}unpack_double(){const e=this.unpack_uint32(),t=this.unpack_uint32(),r=e>>31,s=(e>>20&2047)-1023,a=(e&1048575|1048576)*2**(s-20)+t*2**(s-52);return(r===0?1:-1)*a}read(e){const t=this.index;if(t+e<=this.length)return this.dataView.subarray(t,t+e);throw new Error("BinaryPackFailure: read index out of range")}}class qn{getBuffer(){return this._bufferBuilder.toArrayBuffer()}pack(e){if(typeof e=="string")this.pack_string(e);else if(typeof e=="number")Math.floor(e)===e?this.pack_integer(e):this.pack_double(e);else if(typeof e=="boolean")e===!0?this._bufferBuilder.append(195):e===!1&&this._bufferBuilder.append(194);else if(e===void 0)this._bufferBuilder.append(192);else if(typeof e=="object")if(e===null)this._bufferBuilder.append(192);else{const t=e.constructor;if(e instanceof Array){const r=this.pack_array(e);if(r instanceof Promise)return r.then(()=>this._bufferBuilder.flush())}else if(e instanceof ArrayBuffer)this.pack_bin(new Uint8Array(e));else if("BYTES_PER_ELEMENT"in e){const r=e;this.pack_bin(new Uint8Array(r.buffer,r.byteOffset,r.byteLength))}else if(e instanceof Date)this.pack_string(e.toString());else{if(e instanceof Blob)return e.arrayBuffer().then(r=>{this.pack_bin(new Uint8Array(r)),this._bufferBuilder.flush()});if(t==Object||t.toString().startsWith("class")){const r=this.pack_object(e);if(r instanceof Promise)return r.then(()=>this._bufferBuilder.flush())}else throw new Error(`Type "${t.toString()}" not yet supported`)}}else throw new Error(`Type "${typeof e}" not yet supported`);this._bufferBuilder.flush()}pack_bin(e){const t=e.length;if(t<=15)this.pack_uint8(160+t);else if(t<=65535)this._bufferBuilder.append(218),this.pack_uint16(t);else if(t<=4294967295)this._bufferBuilder.append(219),this.pack_uint32(t);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(e)}pack_string(e){const t=this._textEncoder.encode(e),r=t.length;if(r<=15)this.pack_uint8(176+r);else if(r<=65535)this._bufferBuilder.append(216),this.pack_uint16(r);else if(r<=4294967295)this._bufferBuilder.append(217),this.pack_uint32(r);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(t)}pack_array(e){const t=e.length;if(t<=15)this.pack_uint8(144+t);else if(t<=65535)this._bufferBuilder.append(220),this.pack_uint16(t);else if(t<=4294967295)this._bufferBuilder.append(221),this.pack_uint32(t);else throw new Error("Invalid length");const r=s=>{if(s<t){const o=this.pack(e[s]);return o instanceof Promise?o.then(()=>r(s+1)):r(s+1)}};return r(0)}pack_integer(e){if(e>=-32&&e<=127)this._bufferBuilder.append(e&255);else if(e>=0&&e<=255)this._bufferBuilder.append(204),this.pack_uint8(e);else if(e>=-128&&e<=127)this._bufferBuilder.append(208),this.pack_int8(e);else if(e>=0&&e<=65535)this._bufferBuilder.append(205),this.pack_uint16(e);else if(e>=-32768&&e<=32767)this._bufferBuilder.append(209),this.pack_int16(e);else if(e>=0&&e<=4294967295)this._bufferBuilder.append(206),this.pack_uint32(e);else if(e>=-2147483648&&e<=2147483647)this._bufferBuilder.append(210),this.pack_int32(e);else if(e>=-9223372036854776e3&&e<=9223372036854776e3)this._bufferBuilder.append(211),this.pack_int64(e);else if(e>=0&&e<=18446744073709552e3)this._bufferBuilder.append(207),this.pack_uint64(e);else throw new Error("Invalid integer")}pack_double(e){let t=0;e<0&&(t=1,e=-e);const r=Math.floor(Math.log(e)/Math.LN2),s=e/2**r-1,o=Math.floor(s*2**52),a=2**32,l=t<<31|r+1023<<20|o/a&1048575,c=o%a;this._bufferBuilder.append(203),this.pack_int32(l),this.pack_int32(c)}pack_object(e){const t=Object.keys(e),r=t.length;if(r<=15)this.pack_uint8(128+r);else if(r<=65535)this._bufferBuilder.append(222),this.pack_uint16(r);else if(r<=4294967295)this._bufferBuilder.append(223),this.pack_uint32(r);else throw new Error("Invalid length");const s=o=>{if(o<t.length){const a=t[o];if(e.hasOwnProperty(a)){this.pack(a);const l=this.pack(e[a]);if(l instanceof Promise)return l.then(()=>s(o+1))}return s(o+1)}};return s(0)}pack_uint8(e){this._bufferBuilder.append(e)}pack_uint16(e){this._bufferBuilder.append(e>>8),this._bufferBuilder.append(e&255)}pack_uint32(e){const t=e&4294967295;this._bufferBuilder.append((t&4278190080)>>>24),this._bufferBuilder.append((t&16711680)>>>16),this._bufferBuilder.append((t&65280)>>>8),this._bufferBuilder.append(t&255)}pack_uint64(e){const t=e/4294967296,r=e%2**32;this._bufferBuilder.append((t&4278190080)>>>24),this._bufferBuilder.append((t&16711680)>>>16),this._bufferBuilder.append((t&65280)>>>8),this._bufferBuilder.append(t&255),this._bufferBuilder.append((r&4278190080)>>>24),this._bufferBuilder.append((r&16711680)>>>16),this._bufferBuilder.append((r&65280)>>>8),this._bufferBuilder.append(r&255)}pack_int8(e){this._bufferBuilder.append(e&255)}pack_int16(e){this._bufferBuilder.append((e&65280)>>8),this._bufferBuilder.append(e&255)}pack_int32(e){this._bufferBuilder.append(e>>>24&255),this._bufferBuilder.append((e&16711680)>>>16),this._bufferBuilder.append((e&65280)>>>8),this._bufferBuilder.append(e&255)}pack_int64(e){const t=Math.floor(e/4294967296),r=e%2**32;this._bufferBuilder.append((t&4278190080)>>>24),this._bufferBuilder.append((t&16711680)>>>16),this._bufferBuilder.append((t&65280)>>>8),this._bufferBuilder.append(t&255),this._bufferBuilder.append((r&4278190080)>>>24),this._bufferBuilder.append((r&16711680)>>>16),this._bufferBuilder.append((r&65280)>>>8),this._bufferBuilder.append(r&255)}constructor(){this._bufferBuilder=new $n,this._textEncoder=new TextEncoder}}let Cr=!0,xr=!0;function Ye(n,e,t){const r=n.match(e);return r&&r.length>=t&&parseFloat(r[t],10)}function Le(n,e,t){if(!n.RTCPeerConnection)return;const r=n.RTCPeerConnection.prototype,s=r.addEventListener;r.addEventListener=function(a,l){if(a!==e)return s.apply(this,arguments);const c=d=>{const u=t(d);u&&(l.handleEvent?l.handleEvent(u):l(u))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(l,c),s.apply(this,[a,c])};const o=r.removeEventListener;r.removeEventListener=function(a,l){if(a!==e||!this._eventMap||!this._eventMap[e])return o.apply(this,arguments);if(!this._eventMap[e].has(l))return o.apply(this,arguments);const c=this._eventMap[e].get(l);return this._eventMap[e].delete(l),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,o.apply(this,[a,c])},Object.defineProperty(r,"on"+e,{get(){return this["_on"+e]},set(a){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),a&&this.addEventListener(e,this["_on"+e]=a)},enumerable:!0,configurable:!0})}function Un(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(Cr=n,n?"adapter.js logging disabled":"adapter.js logging enabled")}function Nn(n){return typeof n!="boolean"?new Error("Argument type: "+typeof n+". Please use a boolean."):(xr=!n,"adapter.js deprecation warnings "+(n?"disabled":"enabled"))}function Sr(){if(typeof window=="object"){if(Cr)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Gt(n,e){xr&&console.warn(n+" is deprecated, please use "+e+" instead.")}function Fn(n){const e={browser:null,version:null};if(typeof n>"u"||!n.navigator||!n.navigator.userAgent)return e.browser="Not a browser.",e;const{navigator:t}=n;if(t.userAgentData&&t.userAgentData.brands){const r=t.userAgentData.brands.find(s=>s.brand==="Chromium");if(r)return{browser:"chrome",version:parseInt(r.version,10)}}if(t.mozGetUserMedia)e.browser="firefox",e.version=parseInt(Ye(t.userAgent,/Firefox\/(\d+)\./,1));else if(t.webkitGetUserMedia||n.isSecureContext===!1&&n.webkitRTCPeerConnection)e.browser="chrome",e.version=parseInt(Ye(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2));else if(n.RTCPeerConnection&&t.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=parseInt(Ye(t.userAgent,/AppleWebKit\/(\d+)\./,1)),e.supportsUnifiedPlan=n.RTCRtpTransceiver&&"currentDirection"in n.RTCRtpTransceiver.prototype,e._safariVersion=Ye(t.userAgent,/Version\/(\d+(\.?\d+))/,1);else return e.browser="Not a supported browser.",e;return e}function or(n){return Object.prototype.toString.call(n)==="[object Object]"}function Tr(n){return or(n)?Object.keys(n).reduce(function(e,t){const r=or(n[t]),s=r?Tr(n[t]):n[t],o=r&&!Object.keys(s).length;return s===void 0||o?e:Object.assign(e,{[t]:s})},{}):n}function $t(n,e,t){!e||t.has(e.id)||(t.set(e.id,e),Object.keys(e).forEach(r=>{r.endsWith("Id")?$t(n,n.get(e[r]),t):r.endsWith("Ids")&&e[r].forEach(s=>{$t(n,n.get(s),t)})}))}function cr(n,e,t){const r=t?"outbound-rtp":"inbound-rtp",s=new Map;if(e===null)return s;const o=[];return n.forEach(a=>{a.type==="track"&&a.trackIdentifier===e.id&&o.push(a)}),o.forEach(a=>{n.forEach(l=>{l.type===r&&l.trackId===a.id&&$t(n,l,s)})}),s}const lr=Sr;function Rr(n,e){const t=n&&n.navigator;if(!t.mediaDevices)return;const r=function(l){if(typeof l!="object"||l.mandatory||l.optional)return l;const c={};return Object.keys(l).forEach(d=>{if(d==="require"||d==="advanced"||d==="mediaSource")return;const u=typeof l[d]=="object"?l[d]:{ideal:l[d]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);const f=function(p,m){return p?p+m.charAt(0).toUpperCase()+m.slice(1):m==="deviceId"?"sourceId":m};if(u.ideal!==void 0){c.optional=c.optional||[];let p={};typeof u.ideal=="number"?(p[f("min",d)]=u.ideal,c.optional.push(p),p={},p[f("max",d)]=u.ideal,c.optional.push(p)):(p[f("",d)]=u.ideal,c.optional.push(p))}u.exact!==void 0&&typeof u.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[f("",d)]=u.exact):["min","max"].forEach(p=>{u[p]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[f(p,d)]=u[p])})}),l.advanced&&(c.optional=(c.optional||[]).concat(l.advanced)),c},s=function(l,c){if(e.version>=61)return c(l);if(l=JSON.parse(JSON.stringify(l)),l&&typeof l.audio=="object"){const d=function(u,f,p){f in u&&!(p in u)&&(u[p]=u[f],delete u[f])};l=JSON.parse(JSON.stringify(l)),d(l.audio,"autoGainControl","googAutoGainControl"),d(l.audio,"noiseSuppression","googNoiseSuppression"),l.audio=r(l.audio)}if(l&&typeof l.video=="object"){let d=l.video.facingMode;d=d&&(typeof d=="object"?d:{ideal:d});const u=e.version<66;if(d&&(d.exact==="user"||d.exact==="environment"||d.ideal==="user"||d.ideal==="environment")&&!(t.mediaDevices.getSupportedConstraints&&t.mediaDevices.getSupportedConstraints().facingMode&&!u)){delete l.video.facingMode;let f;if(d.exact==="environment"||d.ideal==="environment"?f=["back","rear"]:(d.exact==="user"||d.ideal==="user")&&(f=["front"]),f)return t.mediaDevices.enumerateDevices().then(p=>{p=p.filter(S=>S.kind==="videoinput");let m=p.find(S=>f.some(T=>S.label.toLowerCase().includes(T)));return!m&&p.length&&f.includes("back")&&(m=p[p.length-1]),m&&(l.video.deviceId=d.exact?{exact:m.deviceId}:{ideal:m.deviceId}),l.video=r(l.video),lr("chrome: "+JSON.stringify(l)),c(l)})}l.video=r(l.video)}return lr("chrome: "+JSON.stringify(l)),c(l)},o=function(l){return e.version>=64?l:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[l.name]||l.name,message:l.message,constraint:l.constraint||l.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},a=function(l,c,d){s(l,u=>{t.webkitGetUserMedia(u,c,f=>{d&&d(o(f))})})};if(t.getUserMedia=a.bind(t),t.mediaDevices.getUserMedia){const l=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(c){return s(c,d=>l(d).then(u=>{if(d.audio&&!u.getAudioTracks().length||d.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(f=>{f.stop()}),new DOMException("","NotFoundError");return u},u=>Promise.reject(o(u))))}}}function Pr(n){n.MediaStream=n.MediaStream||n.webkitMediaStream}function Er(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("ontrack"in n.RTCPeerConnection.prototype)){Object.defineProperty(n.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(t){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=t)},enumerable:!0,configurable:!0});const e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",s=>{let o;n.RTCPeerConnection.prototype.getReceivers?o=this.getReceivers().find(l=>l.track&&l.track.id===s.track.id):o={track:s.track};const a=new Event("track");a.track=s.track,a.receiver=o,a.transceiver={receiver:o},a.streams=[r.stream],this.dispatchEvent(a)}),r.stream.getTracks().forEach(s=>{let o;n.RTCPeerConnection.prototype.getReceivers?o=this.getReceivers().find(l=>l.track&&l.track.id===s.id):o={track:s};const a=new Event("track");a.track=s,a.receiver=o,a.transceiver={receiver:o},a.streams=[r.stream],this.dispatchEvent(a)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else Le(n,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function wr(n){if(typeof n=="object"&&n.RTCPeerConnection&&!("getSenders"in n.RTCPeerConnection.prototype)&&"createDTMFSender"in n.RTCPeerConnection.prototype){const e=function(s,o){return{track:o,get dtmf(){return this._dtmf===void 0&&(o.kind==="audio"?this._dtmf=s.createDTMFSender(o):this._dtmf=null),this._dtmf},_pc:s}};if(!n.RTCPeerConnection.prototype.getSenders){n.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const s=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(l,c){let d=s.apply(this,arguments);return d||(d=e(this,l),this._senders.push(d)),d};const o=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(l){o.apply(this,arguments);const c=this._senders.indexOf(l);c!==-1&&this._senders.splice(c,1)}}const t=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(o){this._senders=this._senders||[],t.apply(this,[o]),o.getTracks().forEach(a=>{this._senders.push(e(this,a))})};const r=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(o){this._senders=this._senders||[],r.apply(this,[o]),o.getTracks().forEach(a=>{const l=this._senders.find(c=>c.track===a);l&&this._senders.splice(this._senders.indexOf(l),1)})}}else if(typeof n=="object"&&n.RTCPeerConnection&&"getSenders"in n.RTCPeerConnection.prototype&&"createDTMFSender"in n.RTCPeerConnection.prototype&&n.RTCRtpSender&&!("dtmf"in n.RTCRtpSender.prototype)){const e=n.RTCPeerConnection.prototype.getSenders;n.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(s=>s._pc=this),r},Object.defineProperty(n.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Mr(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender&&n.RTCRtpReceiver))return;if(!("getStats"in n.RTCRtpSender.prototype)){const t=n.RTCPeerConnection.prototype.getSenders;t&&(n.RTCPeerConnection.prototype.getSenders=function(){const o=t.apply(this,[]);return o.forEach(a=>a._pc=this),o});const r=n.RTCPeerConnection.prototype.addTrack;r&&(n.RTCPeerConnection.prototype.addTrack=function(){const o=r.apply(this,arguments);return o._pc=this,o}),n.RTCRtpSender.prototype.getStats=function(){const o=this;return this._pc.getStats().then(a=>cr(a,o.track,!0))}}if(!("getStats"in n.RTCRtpReceiver.prototype)){const t=n.RTCPeerConnection.prototype.getReceivers;t&&(n.RTCPeerConnection.prototype.getReceivers=function(){const s=t.apply(this,[]);return s.forEach(o=>o._pc=this),s}),Le(n,"track",r=>(r.receiver._pc=r.srcElement,r)),n.RTCRtpReceiver.prototype.getStats=function(){const s=this;return this._pc.getStats().then(o=>cr(o,s.track,!1))}}if(!("getStats"in n.RTCRtpSender.prototype&&"getStats"in n.RTCRtpReceiver.prototype))return;const e=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof n.MediaStreamTrack){const r=arguments[0];let s,o,a;return this.getSenders().forEach(l=>{l.track===r&&(s?a=!0:s=l)}),this.getReceivers().forEach(l=>(l.track===r&&(o?a=!0:o=l),l.track===r)),a||s&&o?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):s?s.getStats():o?o.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function Ir(n){n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(a=>this._shimmedLocalStreams[a][0])};const e=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addTrack=function(a,l){if(!l)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const c=e.apply(this,arguments);return this._shimmedLocalStreams[l.id]?this._shimmedLocalStreams[l.id].indexOf(c)===-1&&this._shimmedLocalStreams[l.id].push(c):this._shimmedLocalStreams[l.id]=[l,c],c};const t=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(a){this._shimmedLocalStreams=this._shimmedLocalStreams||{},a.getTracks().forEach(d=>{if(this.getSenders().find(f=>f.track===d))throw new DOMException("Track already exists.","InvalidAccessError")});const l=this.getSenders();t.apply(this,arguments);const c=this.getSenders().filter(d=>l.indexOf(d)===-1);this._shimmedLocalStreams[a.id]=[a].concat(c)};const r=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[a.id],r.apply(this,arguments)};const s=n.RTCPeerConnection.prototype.removeTrack;n.RTCPeerConnection.prototype.removeTrack=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},a&&Object.keys(this._shimmedLocalStreams).forEach(l=>{const c=this._shimmedLocalStreams[l].indexOf(a);c!==-1&&this._shimmedLocalStreams[l].splice(c,1),this._shimmedLocalStreams[l].length===1&&delete this._shimmedLocalStreams[l]}),s.apply(this,arguments)}}function Dr(n,e){if(!n.RTCPeerConnection)return;if(n.RTCPeerConnection.prototype.addTrack&&e.version>=65)return Ir(n);const t=n.RTCPeerConnection.prototype.getLocalStreams;n.RTCPeerConnection.prototype.getLocalStreams=function(){const u=t.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map(f=>this._reverseStreams[f.id])};const r=n.RTCPeerConnection.prototype.addStream;n.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach(f=>{if(this.getSenders().find(m=>m.track===f))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[u.id]){const f=new n.MediaStream(u.getTracks());this._streams[u.id]=f,this._reverseStreams[f.id]=u,u=f}r.apply(this,[u])};const s=n.RTCPeerConnection.prototype.removeStream;n.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},s.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},n.RTCPeerConnection.prototype.addTrack=function(u,f){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const p=[].slice.call(arguments,1);if(p.length!==1||!p[0].getTracks().find(T=>T===u))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(T=>T.track===u))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const S=this._streams[f.id];if(S)S.addTrack(u),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const T=new n.MediaStream([u]);this._streams[f.id]=T,this._reverseStreams[T.id]=f,this.addStream(T)}return this.getSenders().find(T=>T.track===u)};function o(d,u){let f=u.sdp;return Object.keys(d._reverseStreams||[]).forEach(p=>{const m=d._reverseStreams[p],S=d._streams[m.id];f=f.replace(new RegExp(S.id,"g"),m.id)}),new RTCSessionDescription({type:u.type,sdp:f})}function a(d,u){let f=u.sdp;return Object.keys(d._reverseStreams||[]).forEach(p=>{const m=d._reverseStreams[p],S=d._streams[m.id];f=f.replace(new RegExp(m.id,"g"),S.id)}),new RTCSessionDescription({type:u.type,sdp:f})}["createOffer","createAnswer"].forEach(function(d){const u=n.RTCPeerConnection.prototype[d],f={[d](){const p=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[S=>{const T=o(this,S);p[0].apply(null,[T])},S=>{p[1]&&p[1].apply(null,S)},arguments[2]]):u.apply(this,arguments).then(S=>o(this,S))}};n.RTCPeerConnection.prototype[d]=f[d]});const l=n.RTCPeerConnection.prototype.setLocalDescription;n.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?l.apply(this,arguments):(arguments[0]=a(this,arguments[0]),l.apply(this,arguments))};const c=Object.getOwnPropertyDescriptor(n.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(n.RTCPeerConnection.prototype,"localDescription",{get(){const d=c.get.apply(this);return d.type===""?d:o(this,d)}}),n.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(u._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let p;Object.keys(this._streams).forEach(m=>{this._streams[m].getTracks().find(T=>u.track===T)&&(p=this._streams[m])}),p&&(p.getTracks().length===1?this.removeStream(this._reverseStreams[p.id]):p.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function zt(n,e){!n.RTCPeerConnection&&n.webkitRTCPeerConnection&&(n.RTCPeerConnection=n.webkitRTCPeerConnection),n.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const r=n.RTCPeerConnection.prototype[t],s={[t](){return arguments[0]=new(t==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};n.RTCPeerConnection.prototype[t]=s[t]})}function jr(n,e){Le(n,"negotiationneeded",t=>{const r=t.target;if(!((e.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")&&r.signalingState!=="stable"))return t})}const dr=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:jr,shimAddTrackRemoveTrack:Dr,shimAddTrackRemoveTrackWithNative:Ir,shimGetSendersWithDtmf:wr,shimGetUserMedia:Rr,shimMediaStream:Pr,shimOnTrack:Er,shimPeerConnection:zt,shimSenderReceiverGetStats:Mr},Symbol.toStringTag,{value:"Module"}));function Lr(n,e){const t=n&&n.navigator,r=n&&n.MediaStreamTrack;if(t.getUserMedia=function(s,o,a){Gt("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),t.mediaDevices.getUserMedia(s).then(o,a)},!(e.version>55&&"autoGainControl"in t.mediaDevices.getSupportedConstraints())){const s=function(a,l,c){l in a&&!(c in a)&&(a[c]=a[l],delete a[l])},o=t.mediaDevices.getUserMedia.bind(t.mediaDevices);if(t.mediaDevices.getUserMedia=function(a){return typeof a=="object"&&typeof a.audio=="object"&&(a=JSON.parse(JSON.stringify(a)),s(a.audio,"autoGainControl","mozAutoGainControl"),s(a.audio,"noiseSuppression","mozNoiseSuppression")),o(a)},r&&r.prototype.getSettings){const a=r.prototype.getSettings;r.prototype.getSettings=function(){const l=a.apply(this,arguments);return s(l,"mozAutoGainControl","autoGainControl"),s(l,"mozNoiseSuppression","noiseSuppression"),l}}if(r&&r.prototype.applyConstraints){const a=r.prototype.applyConstraints;r.prototype.applyConstraints=function(l){return this.kind==="audio"&&typeof l=="object"&&(l=JSON.parse(JSON.stringify(l)),s(l,"autoGainControl","mozAutoGainControl"),s(l,"noiseSuppression","mozNoiseSuppression")),a.apply(this,[l])}}}}function Vn(n,e){n.navigator.mediaDevices&&"getDisplayMedia"in n.navigator.mediaDevices||n.navigator.mediaDevices&&(n.navigator.mediaDevices.getDisplayMedia=function(r){if(!(r&&r.video)){const s=new DOMException("getDisplayMedia without video constraints is undefined");return s.name="NotFoundError",s.code=8,Promise.reject(s)}return r.video===!0?r.video={mediaSource:e}:r.video.mediaSource=e,n.navigator.mediaDevices.getUserMedia(r)})}function Ar(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Bt(n,e){if(typeof n!="object"||!(n.RTCPeerConnection||n.mozRTCPeerConnection))return;!n.RTCPeerConnection&&n.mozRTCPeerConnection&&(n.RTCPeerConnection=n.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){const o=n.RTCPeerConnection.prototype[s],a={[s](){return arguments[0]=new(s==="addIceCandidate"?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};n.RTCPeerConnection.prototype[s]=a[s]});const t={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){const[o,a,l]=arguments;return r.apply(this,[o||null]).then(c=>{if(e.version<53&&!a)try{c.forEach(d=>{d.type=t[d.type]||d.type})}catch(d){if(d.name!=="TypeError")throw d;c.forEach((u,f)=>{c.set(f,Object.assign({},u,{type:t[u.type]||u.type}))})}return c}).then(a,l)}}function Or(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender)||n.RTCRtpSender&&"getStats"in n.RTCRtpSender.prototype)return;const e=n.RTCPeerConnection.prototype.getSenders;e&&(n.RTCPeerConnection.prototype.getSenders=function(){const s=e.apply(this,[]);return s.forEach(o=>o._pc=this),s});const t=n.RTCPeerConnection.prototype.addTrack;t&&(n.RTCPeerConnection.prototype.addTrack=function(){const s=t.apply(this,arguments);return s._pc=this,s}),n.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function $r(n){if(!(typeof n=="object"&&n.RTCPeerConnection&&n.RTCRtpSender)||n.RTCRtpSender&&"getStats"in n.RTCRtpReceiver.prototype)return;const e=n.RTCPeerConnection.prototype.getReceivers;e&&(n.RTCPeerConnection.prototype.getReceivers=function(){const r=e.apply(this,[]);return r.forEach(s=>s._pc=this),r}),Le(n,"track",t=>(t.receiver._pc=t.srcElement,t)),n.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function zr(n){!n.RTCPeerConnection||"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(t){Gt("removeStream","removeTrack"),this.getSenders().forEach(r=>{r.track&&t.getTracks().includes(r.track)&&this.removeTrack(r)})})}function Br(n){n.DataChannel&&!n.RTCDataChannel&&(n.RTCDataChannel=n.DataChannel)}function qr(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.addTransceiver;e&&(n.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];const s=r.length>0;s&&r.forEach(a=>{if("rid"in a&&!/^[a-z0-9]{0,16}$/i.test(a.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in a&&!(parseFloat(a.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in a&&!(parseFloat(a.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const o=e.apply(this,arguments);if(s){const{sender:a}=o,l=a.getParameters();(!("encodings"in l)||l.encodings.length===1&&Object.keys(l.encodings[0]).length===0)&&(l.encodings=r,a.sendEncodings=r,this.setParametersPromises.push(a.setParameters(l).then(()=>{delete a.sendEncodings}).catch(()=>{delete a.sendEncodings})))}return o})}function Ur(n){if(!(typeof n=="object"&&n.RTCRtpSender))return;const e=n.RTCRtpSender.prototype.getParameters;e&&(n.RTCRtpSender.prototype.getParameters=function(){const r=e.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function Nr(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function Fr(n){if(!(typeof n=="object"&&n.RTCPeerConnection))return;const e=n.RTCPeerConnection.prototype.createAnswer;n.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}const ur=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:qr,shimCreateAnswer:Fr,shimCreateOffer:Nr,shimGetDisplayMedia:Vn,shimGetParameters:Ur,shimGetUserMedia:Lr,shimOnTrack:Ar,shimPeerConnection:Bt,shimRTCDataChannel:Br,shimReceiverGetStats:$r,shimRemoveStream:zr,shimSenderGetStats:Or},Symbol.toStringTag,{value:"Module"}));function Vr(n){if(!(typeof n!="object"||!n.RTCPeerConnection)){if("getLocalStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in n.RTCPeerConnection.prototype)){const e=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addStream=function(r){this._localStreams||(this._localStreams=[]),this._localStreams.includes(r)||this._localStreams.push(r),r.getAudioTracks().forEach(s=>e.call(this,s,r)),r.getVideoTracks().forEach(s=>e.call(this,s,r))},n.RTCPeerConnection.prototype.addTrack=function(r,...s){return s&&s.forEach(o=>{this._localStreams?this._localStreams.includes(o)||this._localStreams.push(o):this._localStreams=[o]}),e.apply(this,arguments)}}"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const r=this._localStreams.indexOf(t);if(r===-1)return;this._localStreams.splice(r,1);const s=t.getTracks();this.getSenders().forEach(o=>{s.includes(o.track)&&this.removeTrack(o)})})}}function Hr(n){if(!(typeof n!="object"||!n.RTCPeerConnection)&&("getRemoteStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in n.RTCPeerConnection.prototype))){Object.defineProperty(n.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(t){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=t),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(s=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(s))return;this._remoteStreams.push(s);const o=new Event("addstream");o.stream=s,this.dispatchEvent(o)})})}});const e=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){const r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(s){s.streams.forEach(o=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(o)>=0)return;r._remoteStreams.push(o);const a=new Event("addstream");a.stream=o,r.dispatchEvent(a)})}),e.apply(r,arguments)}}}function Jr(n){if(typeof n!="object"||!n.RTCPeerConnection)return;const e=n.RTCPeerConnection.prototype,t=e.createOffer,r=e.createAnswer,s=e.setLocalDescription,o=e.setRemoteDescription,a=e.addIceCandidate;e.createOffer=function(d,u){const f=arguments.length>=2?arguments[2]:arguments[0],p=t.apply(this,[f]);return u?(p.then(d,u),Promise.resolve()):p},e.createAnswer=function(d,u){const f=arguments.length>=2?arguments[2]:arguments[0],p=r.apply(this,[f]);return u?(p.then(d,u),Promise.resolve()):p};let l=function(c,d,u){const f=s.apply(this,[c]);return u?(f.then(d,u),Promise.resolve()):f};e.setLocalDescription=l,l=function(c,d,u){const f=o.apply(this,[c]);return u?(f.then(d,u),Promise.resolve()):f},e.setRemoteDescription=l,l=function(c,d,u){const f=a.apply(this,[c]);return u?(f.then(d,u),Promise.resolve()):f},e.addIceCandidate=l}function Zr(n){const e=n&&n.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const t=e.mediaDevices,r=t.getUserMedia.bind(t);e.mediaDevices.getUserMedia=s=>r(Gr(s))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(r,s,o){e.mediaDevices.getUserMedia(r).then(s,o)}).bind(e))}function Gr(n){return n&&n.video!==void 0?Object.assign({},n,{video:Tr(n.video)}):n}function Yr(n){if(!n.RTCPeerConnection)return;const e=n.RTCPeerConnection;n.RTCPeerConnection=function(r,s){if(r&&r.iceServers){const o=[];for(let a=0;a<r.iceServers.length;a++){let l=r.iceServers[a];l.urls===void 0&&l.url?(Gt("RTCIceServer.url","RTCIceServer.urls"),l=JSON.parse(JSON.stringify(l)),l.urls=l.url,delete l.url,o.push(l)):o.push(r.iceServers[a])}r.iceServers=o}return new e(r,s)},n.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(n.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function Wr(n){typeof n=="object"&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Kr(n){const e=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(r){if(r){typeof r.offerToReceiveAudio<"u"&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);const s=this.getTransceivers().find(a=>a.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):r.offerToReceiveAudio===!0&&!s&&this.addTransceiver("audio",{direction:"recvonly"}),typeof r.offerToReceiveVideo<"u"&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);const o=this.getTransceivers().find(a=>a.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):r.offerToReceiveVideo===!0&&!o&&this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function Xr(n){typeof n!="object"||n.AudioContext||(n.AudioContext=n.webkitAudioContext)}const fr=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:Xr,shimCallbacksAPI:Jr,shimConstraints:Gr,shimCreateOfferLegacy:Kr,shimGetUserMedia:Zr,shimLocalStreamsAPI:Vr,shimRTCIceServerUrls:Yr,shimRemoteStreamsAPI:Hr,shimTrackEventTransceiver:Wr},Symbol.toStringTag,{value:"Module"}));var Qr={exports:{}};(function(n){const e={};e.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},e.localCName=e.generateIdentifier(),e.splitLines=function(t){return t.trim().split(`
`).map(r=>r.trim())},e.splitSections=function(t){return t.split(`
m=`).map((s,o)=>(o>0?"m="+s:s).trim()+`\r
`)},e.getDescription=function(t){const r=e.splitSections(t);return r&&r[0]},e.getMediaSections=function(t){const r=e.splitSections(t);return r.shift(),r},e.matchPrefix=function(t,r){return e.splitLines(t).filter(s=>s.indexOf(r)===0)},e.parseCandidate=function(t){let r;t.indexOf("a=candidate:")===0?r=t.substring(12).split(" "):r=t.substring(10).split(" ");const s={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let o=8;o<r.length;o+=2)switch(r[o]){case"raddr":s.relatedAddress=r[o+1];break;case"rport":s.relatedPort=parseInt(r[o+1],10);break;case"tcptype":s.tcpType=r[o+1];break;case"ufrag":s.ufrag=r[o+1],s.usernameFragment=r[o+1];break;default:s[r[o]]===void 0&&(s[r[o]]=r[o+1]);break}return s},e.writeCandidate=function(t){const r=[];r.push(t.foundation);const s=t.component;s==="rtp"?r.push(1):s==="rtcp"?r.push(2):r.push(s),r.push(t.protocol.toUpperCase()),r.push(t.priority),r.push(t.address||t.ip),r.push(t.port);const o=t.type;return r.push("typ"),r.push(o),o!=="host"&&t.relatedAddress&&t.relatedPort&&(r.push("raddr"),r.push(t.relatedAddress),r.push("rport"),r.push(t.relatedPort)),t.tcpType&&t.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(t.tcpType)),(t.usernameFragment||t.ufrag)&&(r.push("ufrag"),r.push(t.usernameFragment||t.ufrag)),"candidate:"+r.join(" ")},e.parseIceOptions=function(t){return t.substring(14).split(" ")},e.parseRtpMap=function(t){let r=t.substring(9).split(" ");const s={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),s.name=r[0],s.clockRate=parseInt(r[1],10),s.channels=r.length===3?parseInt(r[2],10):1,s.numChannels=s.channels,s},e.writeRtpMap=function(t){let r=t.payloadType;t.preferredPayloadType!==void 0&&(r=t.preferredPayloadType);const s=t.channels||t.numChannels||1;return"a=rtpmap:"+r+" "+t.name+"/"+t.clockRate+(s!==1?"/"+s:"")+`\r
`},e.parseExtmap=function(t){const r=t.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},e.writeExtmap=function(t){return"a=extmap:"+(t.id||t.preferredId)+(t.direction&&t.direction!=="sendrecv"?"/"+t.direction:"")+" "+t.uri+(t.attributes?" "+t.attributes:"")+`\r
`},e.parseFmtp=function(t){const r={};let s;const o=t.substring(t.indexOf(" ")+1).split(";");for(let a=0;a<o.length;a++)s=o[a].trim().split("="),r[s[0].trim()]=s[1];return r},e.writeFmtp=function(t){let r="",s=t.payloadType;if(t.preferredPayloadType!==void 0&&(s=t.preferredPayloadType),t.parameters&&Object.keys(t.parameters).length){const o=[];Object.keys(t.parameters).forEach(a=>{t.parameters[a]!==void 0?o.push(a+"="+t.parameters[a]):o.push(a)}),r+="a=fmtp:"+s+" "+o.join(";")+`\r
`}return r},e.parseRtcpFb=function(t){const r=t.substring(t.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},e.writeRtcpFb=function(t){let r="",s=t.payloadType;return t.preferredPayloadType!==void 0&&(s=t.preferredPayloadType),t.rtcpFeedback&&t.rtcpFeedback.length&&t.rtcpFeedback.forEach(o=>{r+="a=rtcp-fb:"+s+" "+o.type+(o.parameter&&o.parameter.length?" "+o.parameter:"")+`\r
`}),r},e.parseSsrcMedia=function(t){const r=t.indexOf(" "),s={ssrc:parseInt(t.substring(7,r),10)},o=t.indexOf(":",r);return o>-1?(s.attribute=t.substring(r+1,o),s.value=t.substring(o+1)):s.attribute=t.substring(r+1),s},e.parseSsrcGroup=function(t){const r=t.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(s=>parseInt(s,10))}},e.getMid=function(t){const r=e.matchPrefix(t,"a=mid:")[0];if(r)return r.substring(6)},e.parseFingerprint=function(t){const r=t.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},e.getDtlsParameters=function(t,r){return{role:"auto",fingerprints:e.matchPrefix(t+r,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(t,r){let s="a=setup:"+r+`\r
`;return t.fingerprints.forEach(o=>{s+="a=fingerprint:"+o.algorithm+" "+o.value+`\r
`}),s},e.parseCryptoLine=function(t){const r=t.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},e.writeCryptoLine=function(t){return"a=crypto:"+t.tag+" "+t.cryptoSuite+" "+(typeof t.keyParams=="object"?e.writeCryptoKeyParams(t.keyParams):t.keyParams)+(t.sessionParams?" "+t.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(t){if(t.indexOf("inline:")!==0)return null;const r=t.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(t){return t.keyMethod+":"+t.keySalt+(t.lifeTime?"|"+t.lifeTime:"")+(t.mkiValue&&t.mkiLength?"|"+t.mkiValue+":"+t.mkiLength:"")},e.getCryptoParameters=function(t,r){return e.matchPrefix(t+r,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(t,r){const s=e.matchPrefix(t+r,"a=ice-ufrag:")[0],o=e.matchPrefix(t+r,"a=ice-pwd:")[0];return s&&o?{usernameFragment:s.substring(12),password:o.substring(10)}:null},e.writeIceParameters=function(t){let r="a=ice-ufrag:"+t.usernameFragment+`\r
a=ice-pwd:`+t.password+`\r
`;return t.iceLite&&(r+=`a=ice-lite\r
`),r},e.parseRtpParameters=function(t){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},o=e.splitLines(t)[0].split(" ");r.profile=o[2];for(let l=3;l<o.length;l++){const c=o[l],d=e.matchPrefix(t,"a=rtpmap:"+c+" ")[0];if(d){const u=e.parseRtpMap(d),f=e.matchPrefix(t,"a=fmtp:"+c+" ");switch(u.parameters=f.length?e.parseFmtp(f[0]):{},u.rtcpFeedback=e.matchPrefix(t,"a=rtcp-fb:"+c+" ").map(e.parseRtcpFb),r.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(u.name.toUpperCase());break}}}e.matchPrefix(t,"a=extmap:").forEach(l=>{r.headerExtensions.push(e.parseExtmap(l))});const a=e.matchPrefix(t,"a=rtcp-fb:* ").map(e.parseRtcpFb);return r.codecs.forEach(l=>{a.forEach(c=>{l.rtcpFeedback.find(u=>u.type===c.type&&u.parameter===c.parameter)||l.rtcpFeedback.push(c)})}),r},e.writeRtpDescription=function(t,r){let s="";s+="m="+t+" ",s+=r.codecs.length>0?"9":"0",s+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",s+=r.codecs.map(a=>a.preferredPayloadType!==void 0?a.preferredPayloadType:a.payloadType).join(" ")+`\r
`,s+=`c=IN IP4 0.0.0.0\r
`,s+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(a=>{s+=e.writeRtpMap(a),s+=e.writeFmtp(a),s+=e.writeRtcpFb(a)});let o=0;return r.codecs.forEach(a=>{a.maxptime>o&&(o=a.maxptime)}),o>0&&(s+="a=maxptime:"+o+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(a=>{s+=e.writeExtmap(a)}),s},e.parseRtpEncodingParameters=function(t){const r=[],s=e.parseRtpParameters(t),o=s.fecMechanisms.indexOf("RED")!==-1,a=s.fecMechanisms.indexOf("ULPFEC")!==-1,l=e.matchPrefix(t,"a=ssrc:").map(p=>e.parseSsrcMedia(p)).filter(p=>p.attribute==="cname"),c=l.length>0&&l[0].ssrc;let d;const u=e.matchPrefix(t,"a=ssrc-group:FID").map(p=>p.substring(17).split(" ").map(S=>parseInt(S,10)));u.length>0&&u[0].length>1&&u[0][0]===c&&(d=u[0][1]),s.codecs.forEach(p=>{if(p.name.toUpperCase()==="RTX"&&p.parameters.apt){let m={ssrc:c,codecPayloadType:parseInt(p.parameters.apt,10)};c&&d&&(m.rtx={ssrc:d}),r.push(m),o&&(m=JSON.parse(JSON.stringify(m)),m.fec={ssrc:c,mechanism:a?"red+ulpfec":"red"},r.push(m))}}),r.length===0&&c&&r.push({ssrc:c});let f=e.matchPrefix(t,"b=");return f.length&&(f[0].indexOf("b=TIAS:")===0?f=parseInt(f[0].substring(7),10):f[0].indexOf("b=AS:")===0?f=parseInt(f[0].substring(5),10)*1e3*.95-50*40*8:f=void 0,r.forEach(p=>{p.maxBitrate=f})),r},e.parseRtcpParameters=function(t){const r={},s=e.matchPrefix(t,"a=ssrc:").map(l=>e.parseSsrcMedia(l)).filter(l=>l.attribute==="cname")[0];s&&(r.cname=s.value,r.ssrc=s.ssrc);const o=e.matchPrefix(t,"a=rtcp-rsize");r.reducedSize=o.length>0,r.compound=o.length===0;const a=e.matchPrefix(t,"a=rtcp-mux");return r.mux=a.length>0,r},e.writeRtcpParameters=function(t){let r="";return t.reducedSize&&(r+=`a=rtcp-rsize\r
`),t.mux&&(r+=`a=rtcp-mux\r
`),t.ssrc!==void 0&&t.cname&&(r+="a=ssrc:"+t.ssrc+" cname:"+t.cname+`\r
`),r},e.parseMsid=function(t){let r;const s=e.matchPrefix(t,"a=msid:");if(s.length===1)return r=s[0].substring(7).split(" "),{stream:r[0],track:r[1]};const o=e.matchPrefix(t,"a=ssrc:").map(a=>e.parseSsrcMedia(a)).filter(a=>a.attribute==="msid");if(o.length>0)return r=o[0].value.split(" "),{stream:r[0],track:r[1]}},e.parseSctpDescription=function(t){const r=e.parseMLine(t),s=e.matchPrefix(t,"a=max-message-size:");let o;s.length>0&&(o=parseInt(s[0].substring(19),10)),isNaN(o)&&(o=65536);const a=e.matchPrefix(t,"a=sctp-port:");if(a.length>0)return{port:parseInt(a[0].substring(12),10),protocol:r.fmt,maxMessageSize:o};const l=e.matchPrefix(t,"a=sctpmap:");if(l.length>0){const c=l[0].substring(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:o}}},e.writeSctpDescription=function(t,r){let s=[];return t.protocol!=="DTLS/SCTP"?s=["m="+t.kind+" 9 "+t.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:s=["m="+t.kind+" 9 "+t.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&s.push("a=max-message-size:"+r.maxMessageSize+`\r
`),s.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(t,r,s){let o;const a=r!==void 0?r:2;return t?o=t:o=e.generateSessionId(),`v=0\r
o=`+(s||"thisisadapterortc")+" "+o+" "+a+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(t,r){const s=e.splitLines(t);for(let o=0;o<s.length;o++)switch(s[o]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return s[o].substring(2)}return r?e.getDirection(r):"sendrecv"},e.getKind=function(t){return e.splitLines(t)[0].split(" ")[0].substring(2)},e.isRejected=function(t){return t.split(" ",2)[1]==="0"},e.parseMLine=function(t){const s=e.splitLines(t)[0].substring(2).split(" ");return{kind:s[0],port:parseInt(s[1],10),protocol:s[2],fmt:s.slice(3).join(" ")}},e.parseOLine=function(t){const s=e.matchPrefix(t,"o=")[0].substring(2).split(" ");return{username:s[0],sessionId:s[1],sessionVersion:parseInt(s[2],10),netType:s[3],addressType:s[4],address:s[5]}},e.isValidSDP=function(t){if(typeof t!="string"||t.length===0)return!1;const r=e.splitLines(t);for(let s=0;s<r.length;s++)if(r[s].length<2||r[s].charAt(1)!=="=")return!1;return!0},n.exports=e})(Qr);var en=Qr.exports;const ze=br(en),Hn=jn({__proto__:null,default:ze},[en]);function dt(n){if(!n.RTCIceCandidate||n.RTCIceCandidate&&"foundation"in n.RTCIceCandidate.prototype)return;const e=n.RTCIceCandidate;n.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&(r=JSON.parse(JSON.stringify(r)),r.candidate=r.candidate.substring(2)),r.candidate&&r.candidate.length){const s=new e(r),o=ze.parseCandidate(r.candidate);for(const a in o)a in s||Object.defineProperty(s,a,{value:o[a]});return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new e(r)},n.RTCIceCandidate.prototype=e.prototype,Le(n,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new n.RTCIceCandidate(t.candidate),writable:"false"}),t))}function qt(n){!n.RTCIceCandidate||n.RTCIceCandidate&&"relayProtocol"in n.RTCIceCandidate.prototype||Le(n,"icecandidate",e=>{if(e.candidate){const t=ze.parseCandidate(e.candidate.candidate);t.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e})}function ut(n,e){if(!n.RTCPeerConnection)return;"sctp"in n.RTCPeerConnection.prototype||Object.defineProperty(n.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const t=function(l){if(!l||!l.sdp)return!1;const c=ze.splitSections(l.sdp);return c.shift(),c.some(d=>{const u=ze.parseMLine(d);return u&&u.kind==="application"&&u.protocol.indexOf("SCTP")!==-1})},r=function(l){const c=l.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;const d=parseInt(c[1],10);return d!==d?-1:d},s=function(l){let c=65536;return e.browser==="firefox"&&(e.version<57?l===-1?c=16384:c=2147483637:e.version<60?c=e.version===57?65535:65536:c=2147483637),c},o=function(l,c){let d=65536;e.browser==="firefox"&&e.version===57&&(d=65535);const u=ze.matchPrefix(l.sdp,"a=max-message-size:");return u.length>0?d=parseInt(u[0].substring(19),10):e.browser==="firefox"&&c!==-1&&(d=2147483637),d},a=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(t(arguments[0])){const c=r(arguments[0]),d=s(c),u=o(arguments[0],c);let f;d===0&&u===0?f=Number.POSITIVE_INFINITY:d===0||u===0?f=Math.max(d,u):f=Math.min(d,u);const p={};Object.defineProperty(p,"maxMessageSize",{get(){return f}}),this._sctp=p}return a.apply(this,arguments)}}function ft(n){if(!(n.RTCPeerConnection&&"createDataChannel"in n.RTCPeerConnection.prototype))return;function e(r,s){const o=r.send;r.send=function(){const l=arguments[0],c=l.length||l.size||l.byteLength;if(r.readyState==="open"&&s.sctp&&c>s.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+s.sctp.maxMessageSize+" bytes)");return o.apply(r,arguments)}}const t=n.RTCPeerConnection.prototype.createDataChannel;n.RTCPeerConnection.prototype.createDataChannel=function(){const s=t.apply(this,arguments);return e(s,this),s},Le(n,"datachannel",r=>(e(r.channel,r.target),r))}function Ut(n){if(!n.RTCPeerConnection||"connectionState"in n.RTCPeerConnection.prototype)return;const e=n.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(t){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),t&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=t)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(t=>{const r=e[t];e[t]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=s=>{const o=s.target;if(o._lastConnectionState!==o.connectionState){o._lastConnectionState=o.connectionState;const a=new Event("connectionstatechange",s);o.dispatchEvent(a)}return s},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function Nt(n,e){if(!n.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e._safariVersion>=13.1)return;const t=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(s){if(s&&s.sdp&&s.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const o=s.sdp.split(`
`).filter(a=>a.trim()!=="a=extmap-allow-mixed").join(`
`);n.RTCSessionDescription&&s instanceof n.RTCSessionDescription?arguments[0]=new n.RTCSessionDescription({type:s.type,sdp:o}):s.sdp=o}return t.apply(this,arguments)}}function pt(n,e){if(!(n.RTCPeerConnection&&n.RTCPeerConnection.prototype))return;const t=n.RTCPeerConnection.prototype.addIceCandidate;!t||t.length===0||(n.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function ht(n,e){if(!(n.RTCPeerConnection&&n.RTCPeerConnection.prototype))return;const t=n.RTCPeerConnection.prototype.setLocalDescription;!t||t.length===0||(n.RTCPeerConnection.prototype.setLocalDescription=function(){let s=arguments[0]||{};if(typeof s!="object"||s.type&&s.sdp)return t.apply(this,arguments);if(s={type:s.type,sdp:s.sdp},!s.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":s.type="offer";break;default:s.type="answer";break}return s.sdp||s.type!=="offer"&&s.type!=="answer"?t.apply(this,[s]):(s.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(a=>t.apply(this,[a]))})}const Jn=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:Nt,shimAddIceCandidateNullOrEmpty:pt,shimConnectionState:Ut,shimMaxMessageSize:ut,shimParameterlessSetLocalDescription:ht,shimRTCIceCandidate:dt,shimRTCIceCandidateRelayProtocol:qt,shimSendThrowTypeError:ft},Symbol.toStringTag,{value:"Module"}));function Zn({window:n}={},e={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const t=Sr,r=Fn(n),s={browserDetails:r,commonShim:Jn,extractVersion:Ye,disableLog:Un,disableWarnings:Nn,sdp:Hn};switch(r.browser){case"chrome":if(!dr||!zt||!e.shimChrome)return t("Chrome shim is not included in this adapter release."),s;if(r.version===null)return t("Chrome shim can not determine version, not shimming."),s;t("adapter.js shimming chrome."),s.browserShim=dr,pt(n,r),ht(n),Rr(n,r),Pr(n),zt(n,r),Er(n),Dr(n,r),wr(n),Mr(n),jr(n,r),dt(n),qt(n),Ut(n),ut(n,r),ft(n),Nt(n,r);break;case"firefox":if(!ur||!Bt||!e.shimFirefox)return t("Firefox shim is not included in this adapter release."),s;t("adapter.js shimming firefox."),s.browserShim=ur,pt(n,r),ht(n),Lr(n,r),Bt(n,r),Ar(n),zr(n),Or(n),$r(n),Br(n),qr(n),Ur(n),Nr(n),Fr(n),dt(n),Ut(n),ut(n,r),ft(n);break;case"safari":if(!fr||!e.shimSafari)return t("Safari shim is not included in this adapter release."),s;t("adapter.js shimming safari."),s.browserShim=fr,pt(n,r),ht(n),Yr(n),Kr(n),Jr(n),Vr(n),Hr(n),Wr(n),Zr(n),Xr(n),dt(n),qt(n),ut(n,r),ft(n),Nt(n,r);break;default:t("Unsupported browser!");break}return s}const pr=Zn({window:typeof window>"u"?void 0:window});function Ae(n,e,t,r){Object.defineProperty(n,e,{get:t,set:r,enumerable:!0,configurable:!0})}class tn{constructor(){this.chunkedMTU=16300,this._dataCount=1,this.chunk=e=>{const t=[],r=e.byteLength,s=Math.ceil(r/this.chunkedMTU);let o=0,a=0;for(;a<r;){const l=Math.min(r,a+this.chunkedMTU),c=e.slice(a,l),d={__peerData:this._dataCount,n:o,data:c,total:s};t.push(d),a=l,o++}return this._dataCount++,t}}}function Gn(n){let e=0;for(const s of n)e+=s.byteLength;const t=new Uint8Array(e);let r=0;for(const s of n)t.set(s,r),r+=s.byteLength;return t}const Dt=pr.default||pr,Je=new class{isWebRTCSupported(){return typeof RTCPeerConnection<"u"}isBrowserSupported(){const n=this.getBrowser(),e=this.getVersion();return this.supportedBrowsers.includes(n)?n==="chrome"?e>=this.minChromeVersion:n==="firefox"?e>=this.minFirefoxVersion:n==="safari"?!this.isIOS&&e>=this.minSafariVersion:!1:!1}getBrowser(){return Dt.browserDetails.browser}getVersion(){return Dt.browserDetails.version||0}isUnifiedPlanSupported(){const n=this.getBrowser(),e=Dt.browserDetails.version||0;if(n==="chrome"&&e<this.minChromeVersion)return!1;if(n==="firefox"&&e>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let t,r=!1;try{t=new RTCPeerConnection,t.addTransceiver("audio"),r=!0}catch{}finally{t&&t.close()}return r}toString(){return`Supports:
    browser:${this.getBrowser()}
    version:${this.getVersion()}
    isIOS:${this.isIOS}
    isWebRTCSupported:${this.isWebRTCSupported()}
    isBrowserSupported:${this.isBrowserSupported()}
    isUnifiedPlanSupported:${this.isUnifiedPlanSupported()}`}constructor(){this.isIOS=typeof navigator<"u"?["iPad","iPhone","iPod"].includes(navigator.platform):!1,this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}},Yn=n=>!n||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(n),rn=()=>Math.random().toString(36).slice(2),hr={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"};class Wn extends tn{noop(){}blobToArrayBuffer(e,t){const r=new FileReader;return r.onload=function(s){s.target&&t(s.target.result)},r.readAsArrayBuffer(e),r}binaryStringToArrayBuffer(e){const t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r)&255;return t.buffer}isSecure(){return location.protocol==="https:"}constructor(...e){super(...e),this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.defaultConfig=hr,this.browser=Je.getBrowser(),this.browserVersion=Je.getVersion(),this.pack=kr,this.unpack=_r,this.supports=function(){const t={browser:Je.isBrowserSupported(),webRTC:Je.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!t.webRTC)return t;let r;try{r=new RTCPeerConnection(hr),t.audioVideo=!0;let s;try{s=r.createDataChannel("_PEERJSTEST",{ordered:!0}),t.data=!0,t.reliable=!!s.ordered;try{s.binaryType="blob",t.binaryBlob=!Je.isIOS}catch{}}catch{}finally{s&&s.close()}}catch{}finally{r&&r.close()}return t}(),this.validateId=Yn,this.randomToken=rn}}const pe=new Wn,Kn="PeerJS: ";var mr;(function(n){n[n.Disabled=0]="Disabled",n[n.Errors=1]="Errors",n[n.Warnings=2]="Warnings",n[n.All=3]="All"})(mr||(mr={}));class Xn{get logLevel(){return this._logLevel}set logLevel(e){this._logLevel=e}log(...e){this._logLevel>=3&&this._print(3,...e)}warn(...e){this._logLevel>=2&&this._print(2,...e)}error(...e){this._logLevel>=1&&this._print(1,...e)}setLogFunction(e){this._print=e}_print(e,...t){const r=[Kn,...t];for(const s in r)r[s]instanceof Error&&(r[s]="("+r[s].name+") "+r[s].message);e>=3?console.log(...r):e>=2?console.warn("WARNING",...r):e>=1&&console.error("ERROR",...r)}constructor(){this._logLevel=0}}var _=new Xn,Yt={},Qn=Object.prototype.hasOwnProperty,de="~";function Qe(){}Object.create&&(Qe.prototype=Object.create(null),new Qe().__proto__||(de=!1));function es(n,e,t){this.fn=n,this.context=e,this.once=t||!1}function nn(n,e,t,r,s){if(typeof t!="function")throw new TypeError("The listener must be a function");var o=new es(t,r||n,s),a=de?de+e:e;return n._events[a]?n._events[a].fn?n._events[a]=[n._events[a],o]:n._events[a].push(o):(n._events[a]=o,n._eventsCount++),n}function mt(n,e){--n._eventsCount===0?n._events=new Qe:delete n._events[e]}function ae(){this._events=new Qe,this._eventsCount=0}ae.prototype.eventNames=function(){var e=[],t,r;if(this._eventsCount===0)return e;for(r in t=this._events)Qn.call(t,r)&&e.push(de?r.slice(1):r);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e};ae.prototype.listeners=function(e){var t=de?de+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var s=0,o=r.length,a=new Array(o);s<o;s++)a[s]=r[s].fn;return a};ae.prototype.listenerCount=function(e){var t=de?de+e:e,r=this._events[t];return r?r.fn?1:r.length:0};ae.prototype.emit=function(e,t,r,s,o,a){var l=de?de+e:e;if(!this._events[l])return!1;var c=this._events[l],d=arguments.length,u,f;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,r),!0;case 4:return c.fn.call(c.context,t,r,s),!0;case 5:return c.fn.call(c.context,t,r,s,o),!0;case 6:return c.fn.call(c.context,t,r,s,o,a),!0}for(f=1,u=new Array(d-1);f<d;f++)u[f-1]=arguments[f];c.fn.apply(c.context,u)}else{var p=c.length,m;for(f=0;f<p;f++)switch(c[f].once&&this.removeListener(e,c[f].fn,void 0,!0),d){case 1:c[f].fn.call(c[f].context);break;case 2:c[f].fn.call(c[f].context,t);break;case 3:c[f].fn.call(c[f].context,t,r);break;case 4:c[f].fn.call(c[f].context,t,r,s);break;default:if(!u)for(m=1,u=new Array(d-1);m<d;m++)u[m-1]=arguments[m];c[f].fn.apply(c[f].context,u)}}return!0};ae.prototype.on=function(e,t,r){return nn(this,e,t,r,!1)};ae.prototype.once=function(e,t,r){return nn(this,e,t,r,!0)};ae.prototype.removeListener=function(e,t,r,s){var o=de?de+e:e;if(!this._events[o])return this;if(!t)return mt(this,o),this;var a=this._events[o];if(a.fn)a.fn===t&&(!s||a.once)&&(!r||a.context===r)&&mt(this,o);else{for(var l=0,c=[],d=a.length;l<d;l++)(a[l].fn!==t||s&&!a[l].once||r&&a[l].context!==r)&&c.push(a[l]);c.length?this._events[o]=c.length===1?c[0]:c:mt(this,o)}return this};ae.prototype.removeAllListeners=function(e){var t;return e?(t=de?de+e:e,this._events[t]&&mt(this,t)):(this._events=new Qe,this._eventsCount=0),this};ae.prototype.off=ae.prototype.removeListener;ae.prototype.addListener=ae.prototype.on;ae.prefixed=de;ae.EventEmitter=ae;Yt=ae;var Oe={};Ae(Oe,"ConnectionType",()=>ye);Ae(Oe,"PeerErrorType",()=>W);Ae(Oe,"BaseConnectionErrorType",()=>et);Ae(Oe,"DataConnectionErrorType",()=>tt);Ae(Oe,"SerializationType",()=>Ue);Ae(Oe,"SocketEventType",()=>be);Ae(Oe,"ServerMessageType",()=>ne);var ye;(function(n){n.Data="data",n.Media="media"})(ye||(ye={}));var W;(function(n){n.BrowserIncompatible="browser-incompatible",n.Disconnected="disconnected",n.InvalidID="invalid-id",n.InvalidKey="invalid-key",n.Network="network",n.PeerUnavailable="peer-unavailable",n.SslUnavailable="ssl-unavailable",n.ServerError="server-error",n.SocketError="socket-error",n.SocketClosed="socket-closed",n.UnavailableID="unavailable-id",n.WebRTC="webrtc"})(W||(W={}));var et;(function(n){n.NegotiationFailed="negotiation-failed",n.ConnectionClosed="connection-closed"})(et||(et={}));var tt;(function(n){n.NotOpenYet="not-open-yet",n.MessageToBig="message-too-big"})(tt||(tt={}));var Ue;(function(n){n.Binary="binary",n.BinaryUTF8="binary-utf8",n.JSON="json",n.None="raw"})(Ue||(Ue={}));var be;(function(n){n.Message="message",n.Disconnected="disconnected",n.Error="error",n.Close="close"})(be||(be={}));var ne;(function(n){n.Heartbeat="HEARTBEAT",n.Candidate="CANDIDATE",n.Offer="OFFER",n.Answer="ANSWER",n.Open="OPEN",n.Error="ERROR",n.IdTaken="ID-TAKEN",n.InvalidKey="INVALID-KEY",n.Leave="LEAVE",n.Expire="EXPIRE"})(ne||(ne={}));var Wt={};Wt=JSON.parse('{"name":"peerjs","version":"1.5.4","keywords":["peerjs","webrtc","p2p","rtc"],"description":"PeerJS client","homepage":"https://peerjs.com","bugs":{"url":"https://github.com/peers/peerjs/issues"},"repository":{"type":"git","url":"https://github.com/peers/peerjs"},"license":"MIT","contributors":["Michelle Bu <michelle@michellebu.com>","afrokick <devbyru@gmail.com>","ericz <really.ez@gmail.com>","Jairo <kidandcat@gmail.com>","Jonas Gloning <34194370+jonasgloning@users.noreply.github.com>","Jairo Caro-Accino Viciana <jairo@galax.be>","Carlos Caballero <carlos.caballero.gonzalez@gmail.com>","hc <hheennrryy@gmail.com>","Muhammad Asif <capripio@gmail.com>","PrashoonB <prashoonbhattacharjee@gmail.com>","Harsh Bardhan Mishra <47351025+HarshCasper@users.noreply.github.com>","akotynski <aleksanderkotbury@gmail.com>","lmb <i@lmb.io>","Jairooo <jairocaro@msn.com>","Moritz Stckler <moritz.stueckler@gmail.com>","Simon <crydotsnakegithub@gmail.com>","Denis Lukov <denismassters@gmail.com>","Philipp Hancke <fippo@andyet.net>","Hans Oksendahl <hansoksendahl@gmail.com>","Jess <jessachandler@gmail.com>","khankuan <khankuan@gmail.com>","DUODVK <kurmanov.work@gmail.com>","XiZhao <kwang1imsa@gmail.com>","Matthias Lohr <matthias@lohr.me>","=frank tree <=frnktrb@googlemail.com>","Andre Eckardt <aeckardt@outlook.com>","Chris Cowan <agentme49@gmail.com>","Alex Chuev <alex@chuev.com>","alxnull <alxnull@e.mail.de>","Yemel Jardi <angel.jardi@gmail.com>","Ben Parnell <benjaminparnell.94@gmail.com>","Benny Lichtner <bennlich@gmail.com>","fresheneesz <bitetrudpublic@gmail.com>","bob.barstead@exaptive.com <bob.barstead@exaptive.com>","chandika <chandika@gmail.com>","emersion <contact@emersion.fr>","Christopher Van <cvan@users.noreply.github.com>","eddieherm <edhermoso@gmail.com>","Eduardo Pinho <enet4mikeenet@gmail.com>","Evandro Zanatta <ezanatta@tray.net.br>","Gardner Bickford <gardner@users.noreply.github.com>","Gian Luca <gianluca.cecchi@cynny.com>","PatrickJS <github@gdi2290.com>","jonnyf <github@jonathanfoss.co.uk>","Hizkia Felix <hizkifw@gmail.com>","Hristo Oskov <hristo.oskov@gmail.com>","Isaac Madwed <i.madwed@gmail.com>","Ilya Konanykhin <ilya.konanykhin@gmail.com>","jasonbarry <jasbarry@me.com>","Jonathan Burke <jonathan.burke.1311@googlemail.com>","Josh Hamit <josh.hamit@gmail.com>","Jordan Austin <jrax86@gmail.com>","Joel Wetzell <jwetzell@yahoo.com>","xizhao <kevin.wang@cloudera.com>","Alberto Torres <kungfoobar@gmail.com>","Jonathan Mayol <mayoljonathan@gmail.com>","Jefferson Felix <me@jsfelix.dev>","Rolf Erik Lekang <me@rolflekang.com>","Kevin Mai-Husan Chia <mhchia@users.noreply.github.com>","Pepijn de Vos <pepijndevos@gmail.com>","JooYoung <qkdlql@naver.com>","Tobias Speicher <rootcommander@gmail.com>","Steve Blaurock <sblaurock@gmail.com>","Kyrylo Shegeda <shegeda@ualberta.ca>","Diwank Singh Tomer <singh@diwank.name>","Soren Balko <Soeren.Balko@gmail.com>","Arpit Solanki <solankiarpit1997@gmail.com>","Yuki Ito <yuki@gnnk.net>","Artur Zayats <zag2art@gmail.com>"],"funding":{"type":"opencollective","url":"https://opencollective.com/peer"},"collective":{"type":"opencollective","url":"https://opencollective.com/peer"},"files":["dist/*"],"sideEffects":["lib/global.ts","lib/supports.ts"],"main":"dist/bundler.cjs","module":"dist/bundler.mjs","browser-minified":"dist/peerjs.min.js","browser-unminified":"dist/peerjs.js","browser-minified-msgpack":"dist/serializer.msgpack.mjs","types":"dist/types.d.ts","engines":{"node":">= 14"},"targets":{"types":{"source":"lib/exports.ts"},"main":{"source":"lib/exports.ts","sourceMap":{"inlineSources":true}},"module":{"source":"lib/exports.ts","includeNodeModules":["eventemitter3"],"sourceMap":{"inlineSources":true}},"browser-minified":{"context":"browser","outputFormat":"global","optimize":true,"engines":{"browsers":"chrome >= 83, edge >= 83, firefox >= 80, safari >= 15"},"source":"lib/global.ts"},"browser-unminified":{"context":"browser","outputFormat":"global","optimize":false,"engines":{"browsers":"chrome >= 83, edge >= 83, firefox >= 80, safari >= 15"},"source":"lib/global.ts"},"browser-minified-msgpack":{"context":"browser","outputFormat":"esmodule","isLibrary":true,"optimize":true,"engines":{"browsers":"chrome >= 83, edge >= 83, firefox >= 102, safari >= 15"},"source":"lib/dataconnection/StreamConnection/MsgPack.ts"}},"scripts":{"contributors":"git-authors-cli --print=false && prettier --write package.json && git add package.json package-lock.json && git commit -m \\"chore(contributors): update and sort contributors list\\"","check":"tsc --noEmit && tsc -p e2e/tsconfig.json --noEmit","watch":"parcel watch","build":"rm -rf dist && parcel build","prepublishOnly":"npm run build","test":"jest","test:watch":"jest --watch","coverage":"jest --coverage --collectCoverageFrom=\\"./lib/**\\"","format":"prettier --write .","format:check":"prettier --check .","semantic-release":"semantic-release","e2e":"wdio run e2e/wdio.local.conf.ts","e2e:bstack":"wdio run e2e/wdio.bstack.conf.ts"},"devDependencies":{"@parcel/config-default":"^2.9.3","@parcel/packager-ts":"^2.9.3","@parcel/transformer-typescript-tsc":"^2.9.3","@parcel/transformer-typescript-types":"^2.9.3","@semantic-release/changelog":"^6.0.1","@semantic-release/git":"^10.0.1","@swc/core":"^1.3.27","@swc/jest":"^0.2.24","@types/jasmine":"^4.3.4","@wdio/browserstack-service":"^8.11.2","@wdio/cli":"^8.11.2","@wdio/globals":"^8.11.2","@wdio/jasmine-framework":"^8.11.2","@wdio/local-runner":"^8.11.2","@wdio/spec-reporter":"^8.11.2","@wdio/types":"^8.10.4","http-server":"^14.1.1","jest":"^29.3.1","jest-environment-jsdom":"^29.3.1","mock-socket":"^9.0.0","parcel":"^2.9.3","prettier":"^3.0.0","semantic-release":"^21.0.0","ts-node":"^10.9.1","typescript":"^5.0.0","wdio-geckodriver-service":"^5.0.1"},"dependencies":{"@msgpack/msgpack":"^2.8.0","eventemitter3":"^4.0.7","peerjs-js-binarypack":"^2.1.0","webrtc-adapter":"^9.0.0"},"alias":{"process":false,"buffer":false}}');class ts extends Yt.EventEmitter{constructor(e,t,r,s,o,a=5e3){super(),this.pingInterval=a,this._disconnected=!0,this._messagesQueue=[];const l=e?"wss://":"ws://";this._baseUrl=l+t+":"+r+s+"peerjs?key="+o}start(e,t){this._id=e;const r=`${this._baseUrl}&id=${e}&token=${t}`;this._socket||!this._disconnected||(this._socket=new WebSocket(r+"&version="+Wt.version),this._disconnected=!1,this._socket.onmessage=s=>{let o;try{o=JSON.parse(s.data),_.log("Server message received:",o)}catch{_.log("Invalid server message",s.data);return}this.emit(be.Message,o)},this._socket.onclose=s=>{this._disconnected||(_.log("Socket closed.",s),this._cleanup(),this._disconnected=!0,this.emit(be.Disconnected))},this._socket.onopen=()=>{this._disconnected||(this._sendQueuedMessages(),_.log("Socket open"),this._scheduleHeartbeat())})}_scheduleHeartbeat(){this._wsPingTimer=setTimeout(()=>{this._sendHeartbeat()},this.pingInterval)}_sendHeartbeat(){if(!this._wsOpen()){_.log("Cannot send heartbeat, because socket closed");return}const e=JSON.stringify({type:ne.Heartbeat});this._socket.send(e),this._scheduleHeartbeat()}_wsOpen(){return!!this._socket&&this._socket.readyState===1}_sendQueuedMessages(){const e=[...this._messagesQueue];this._messagesQueue=[];for(const t of e)this.send(t)}send(e){if(this._disconnected)return;if(!this._id){this._messagesQueue.push(e);return}if(!e.type){this.emit(be.Error,"Invalid message");return}if(!this._wsOpen())return;const t=JSON.stringify(e);this._socket.send(t)}close(){this._disconnected||(this._cleanup(),this._disconnected=!0)}_cleanup(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)}}class sn{constructor(e){this.connection=e}startConnection(e){const t=this._startPeerConnection();if(this.connection.peerConnection=t,this.connection.type===ye.Media&&e._stream&&this._addTracksToConnection(e._stream,t),e.originator){const r=this.connection,s={ordered:!!e.reliable},o=t.createDataChannel(r.label,s);r._initializeDataChannel(o),this._makeOffer()}else this.handleSDP("OFFER",e.sdp)}_startPeerConnection(){_.log("Creating RTCPeerConnection.");const e=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(e),e}_setupListeners(e){const t=this.connection.peer,r=this.connection.connectionId,s=this.connection.type,o=this.connection.provider;_.log("Listening for ICE candidates."),e.onicecandidate=a=>{!a.candidate||!a.candidate.candidate||(_.log(`Received ICE candidates for ${t}:`,a.candidate),o.socket.send({type:ne.Candidate,payload:{candidate:a.candidate,type:s,connectionId:r},dst:t}))},e.oniceconnectionstatechange=()=>{switch(e.iceConnectionState){case"failed":_.log("iceConnectionState is failed, closing connections to "+t),this.connection.emitError(et.NegotiationFailed,"Negotiation of connection to "+t+" failed."),this.connection.close();break;case"closed":_.log("iceConnectionState is closed, closing connections to "+t),this.connection.emitError(et.ConnectionClosed,"Connection to "+t+" closed."),this.connection.close();break;case"disconnected":_.log("iceConnectionState changed to disconnected on the connection with "+t);break;case"completed":e.onicecandidate=()=>{};break}this.connection.emit("iceStateChanged",e.iceConnectionState)},_.log("Listening for data channel"),e.ondatachannel=a=>{_.log("Received data channel");const l=a.channel;o.getConnection(t,r)._initializeDataChannel(l)},_.log("Listening for remote stream"),e.ontrack=a=>{_.log("Received remote stream");const l=a.streams[0],c=o.getConnection(t,r);if(c.type===ye.Media){const d=c;this._addStreamToMediaConnection(l,d)}}}cleanup(){_.log("Cleaning up PeerConnection to "+this.connection.peer);const e=this.connection.peerConnection;if(!e)return;this.connection.peerConnection=null,e.onicecandidate=e.oniceconnectionstatechange=e.ondatachannel=e.ontrack=()=>{};const t=e.signalingState!=="closed";let r=!1;const s=this.connection.dataChannel;s&&(r=!!s.readyState&&s.readyState!=="closed"),(t||r)&&e.close()}async _makeOffer(){const e=this.connection.peerConnection,t=this.connection.provider;try{const r=await e.createOffer(this.connection.options.constraints);_.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp);try{await e.setLocalDescription(r),_.log("Set localDescription:",r,`for:${this.connection.peer}`);let s={sdp:r,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata};if(this.connection.type===ye.Data){const o=this.connection;s={...s,label:o.label,reliable:o.reliable,serialization:o.serialization}}t.socket.send({type:ne.Offer,payload:s,dst:this.connection.peer})}catch(s){s!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"&&(t.emitError(W.WebRTC,s),_.log("Failed to setLocalDescription, ",s))}}catch(r){t.emitError(W.WebRTC,r),_.log("Failed to createOffer, ",r)}}async _makeAnswer(){const e=this.connection.peerConnection,t=this.connection.provider;try{const r=await e.createAnswer();_.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp);try{await e.setLocalDescription(r),_.log("Set localDescription:",r,`for:${this.connection.peer}`),t.socket.send({type:ne.Answer,payload:{sdp:r,type:this.connection.type,connectionId:this.connection.connectionId},dst:this.connection.peer})}catch(s){t.emitError(W.WebRTC,s),_.log("Failed to setLocalDescription, ",s)}}catch(r){t.emitError(W.WebRTC,r),_.log("Failed to create answer, ",r)}}async handleSDP(e,t){t=new RTCSessionDescription(t);const r=this.connection.peerConnection,s=this.connection.provider;_.log("Setting remote description",t);const o=this;try{await r.setRemoteDescription(t),_.log(`Set remoteDescription:${e} for:${this.connection.peer}`),e==="OFFER"&&await o._makeAnswer()}catch(a){s.emitError(W.WebRTC,a),_.log("Failed to setRemoteDescription, ",a)}}async handleCandidate(e){_.log("handleCandidate:",e);try{await this.connection.peerConnection.addIceCandidate(e),_.log(`Added ICE candidate for:${this.connection.peer}`)}catch(t){this.connection.provider.emitError(W.WebRTC,t),_.log("Failed to handleCandidate, ",t)}}_addTracksToConnection(e,t){if(_.log(`add tracks from stream ${e.id} to peer connection`),!t.addTrack)return _.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");e.getTracks().forEach(r=>{t.addTrack(r,e)})}_addStreamToMediaConnection(e,t){_.log(`add stream ${e.id} to media connection ${t.connectionId}`),t.addStream(e)}}class an extends Yt.EventEmitter{emitError(e,t){_.error("Error:",t),this.emit("error",new rs(`${e}`,t))}}class rs extends Error{constructor(e,t){typeof t=="string"?super(t):(super(),Object.assign(this,t)),this.type=e}}class on extends an{get open(){return this._open}constructor(e,t,r){super(),this.peer=e,this.provider=t,this.options=r,this._open=!1,this.metadata=r.metadata}}var Vt;const Ke=class Ke extends on{get type(){return ye.Media}get localStream(){return this._localStream}get remoteStream(){return this._remoteStream}constructor(e,t,r){super(e,t,r),this._localStream=this.options._stream,this.connectionId=this.options.connectionId||Ke.ID_PREFIX+pe.randomToken(),this._negotiator=new sn(this),this._localStream&&this._negotiator.startConnection({_stream:this._localStream,originator:!0})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{_.log(`DC#${this.connectionId} dc connection success`),this.emit("willCloseOnRemote")},this.dataChannel.onclose=()=>{_.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}addStream(e){_.log("Receiving stream",e),this._remoteStream=e,super.emit("stream",e)}handleMessage(e){const t=e.type,r=e.payload;switch(e.type){case ne.Answer:this._negotiator.handleSDP(t,r.sdp),this._open=!0;break;case ne.Candidate:this._negotiator.handleCandidate(r.candidate);break;default:_.warn(`Unrecognized message type:${t} from peer:${this.peer}`);break}}answer(e,t={}){if(this._localStream){_.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}this._localStream=e,t&&t.sdpTransform&&(this.options.sdpTransform=t.sdpTransform),this._negotiator.startConnection({...this.options._payload,_stream:e});const r=this.provider._getMessages(this.connectionId);for(const s of r)this.handleMessage(s);this._open=!0}close(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,super.emit("close"))}};Vt=new WeakMap,xe(Ke,Vt,Ke.ID_PREFIX="mc_");let bt=Ke;class ns{constructor(e){this._options=e}_buildRequest(e){const t=this._options.secure?"https":"http",{host:r,port:s,path:o,key:a}=this._options,l=new URL(`${t}://${r}:${s}${o}${a}/${e}`);return l.searchParams.set("ts",`${Date.now()}${Math.random()}`),l.searchParams.set("version",Wt.version),fetch(l.href,{referrerPolicy:this._options.referrerPolicy})}async retrieveId(){try{const e=await this._buildRequest("id");if(e.status!==200)throw new Error(`Error. Status:${e.status}`);return e.text()}catch(e){_.error("Error retrieving ID",e);let t="";throw this._options.path==="/"&&this._options.host!==pe.CLOUD_HOST&&(t=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+t)}}async listAllPeers(){try{const e=await this._buildRequest("peers");if(e.status!==200){if(e.status===401){let t="";throw this._options.host===pe.CLOUD_HOST?t="It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":t="You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+t)}throw new Error(`Error. Status:${e.status}`)}return e.json()}catch(e){throw _.error("Error retrieving list peers",e),new Error("Could not get list peers from the server."+e)}}}var Ht,Jt;const De=class De extends on{get type(){return ye.Data}constructor(e,t,r){super(e,t,r),this.connectionId=this.options.connectionId||De.ID_PREFIX+rn(),this.label=this.options.label||this.connectionId,this.reliable=!!this.options.reliable,this._negotiator=new sn(this),this._negotiator.startConnection(this.options._payload||{originator:!0,reliable:this.reliable})}_initializeDataChannel(e){this.dataChannel=e,this.dataChannel.onopen=()=>{_.log(`DC#${this.connectionId} dc connection success`),this._open=!0,this.emit("open")},this.dataChannel.onmessage=t=>{_.log(`DC#${this.connectionId} dc onmessage:`,t.data)},this.dataChannel.onclose=()=>{_.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}close(e){if(e!=null&&e.flush){this.send({__peerData:{type:"close"}});return}this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this.dataChannel=null),this.open&&(this._open=!1,super.emit("close"))}send(e,t=!1){if(!this.open){this.emitError(tt.NotOpenYet,"Connection is not open. You should listen for the `open` event before sending messages.");return}return this._send(e,t)}async handleMessage(e){const t=e.payload;switch(e.type){case ne.Answer:await this._negotiator.handleSDP(e.type,t.sdp);break;case ne.Candidate:await this._negotiator.handleCandidate(t.candidate);break;default:_.warn("Unrecognized message type:",e.type,"from peer:",this.peer);break}}};Ht=new WeakMap,Jt=new WeakMap,xe(De,Ht,De.ID_PREFIX="dc_"),xe(De,Jt,De.MAX_BUFFERED_AMOUNT=8388608);let yt=De;class Kt extends yt{get bufferSize(){return this._bufferSize}_initializeDataChannel(e){super._initializeDataChannel(e),this.dataChannel.binaryType="arraybuffer",this.dataChannel.addEventListener("message",t=>this._handleDataMessage(t))}_bufferedSend(e){(this._buffering||!this._trySend(e))&&(this._buffer.push(e),this._bufferSize=this._buffer.length)}_trySend(e){if(!this.open)return!1;if(this.dataChannel.bufferedAmount>yt.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(()=>{this._buffering=!1,this._tryBuffer()},50),!1;try{this.dataChannel.send(e)}catch(t){return _.error(`DC#:${this.connectionId} Error when sending:`,t),this._buffering=!0,this.close(),!1}return!0}_tryBuffer(){if(!this.open||this._buffer.length===0)return;const e=this._buffer[0];this._trySend(e)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}close(e){if(e!=null&&e.flush){this.send({__peerData:{type:"close"}});return}this._buffer=[],this._bufferSize=0,super.close()}constructor(...e){super(...e),this._buffer=[],this._bufferSize=0,this._buffering=!1}}class jt extends Kt{close(e){super.close(e),this._chunkedData={}}constructor(e,t,r){super(e,t,r),this.chunker=new tn,this.serialization=Ue.Binary,this._chunkedData={}}_handleDataMessage({data:e}){const t=_r(e),r=t.__peerData;if(r){if(r.type==="close"){this.close();return}this._handleChunk(t);return}this.emit("data",t)}_handleChunk(e){const t=e.__peerData,r=this._chunkedData[t]||{data:[],count:0,total:e.total};if(r.data[e.n]=new Uint8Array(e.data),r.count++,this._chunkedData[t]=r,r.total===r.count){delete this._chunkedData[t];const s=Gn(r.data);this._handleDataMessage({data:s})}}_send(e,t){const r=kr(e);if(r instanceof Promise)return this._send_blob(r);if(!t&&r.byteLength>this.chunker.chunkedMTU){this._sendChunks(r);return}this._bufferedSend(r)}async _send_blob(e){const t=await e;if(t.byteLength>this.chunker.chunkedMTU){this._sendChunks(t);return}this._bufferedSend(t)}_sendChunks(e){const t=this.chunker.chunk(e);_.log(`DC#${this.connectionId} Try to send ${t.length} chunks...`);for(const r of t)this.send(r,!0)}}class ss extends Kt{_handleDataMessage({data:e}){super.emit("data",e)}_send(e,t){this._bufferedSend(e)}constructor(...e){super(...e),this.serialization=Ue.None}}class is extends Kt{_handleDataMessage({data:e}){const t=this.parse(this.decoder.decode(e)),r=t.__peerData;if(r&&r.type==="close"){this.close();return}this.emit("data",t)}_send(e,t){const r=this.encoder.encode(this.stringify(e));if(r.byteLength>=pe.chunkedMTU){this.emitError(tt.MessageToBig,"Message too big for JSON channel");return}this._bufferedSend(r)}constructor(...e){super(...e),this.serialization=Ue.JSON,this.encoder=new TextEncoder,this.decoder=new TextDecoder,this.stringify=JSON.stringify,this.parse=JSON.parse}}var Zt;const Xe=class Xe extends an{get id(){return this._id}get options(){return this._options}get open(){return this._open}get socket(){return this._socket}get connections(){const e=Object.create(null);for(const[t,r]of this._connections)e[t]=r;return e}get destroyed(){return this._destroyed}get disconnected(){return this._disconnected}constructor(e,t){super(),this._serializers={raw:ss,json:is,binary:jt,"binary-utf8":jt,default:jt},this._id=null,this._lastServerId=null,this._destroyed=!1,this._disconnected=!1,this._open=!1,this._connections=new Map,this._lostMessages=new Map;let r;if(e&&e.constructor==Object?t=e:e&&(r=e.toString()),t={debug:0,host:pe.CLOUD_HOST,port:pe.CLOUD_PORT,path:"/",key:Xe.DEFAULT_KEY,token:pe.randomToken(),config:pe.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin",serializers:{},...t},this._options=t,this._serializers={...this._serializers,...this.options.serializers},this._options.host==="/"&&(this._options.host=window.location.hostname),this._options.path&&(this._options.path[0]!=="/"&&(this._options.path="/"+this._options.path),this._options.path[this._options.path.length-1]!=="/"&&(this._options.path+="/")),this._options.secure===void 0&&this._options.host!==pe.CLOUD_HOST?this._options.secure=pe.isSecure():this._options.host==pe.CLOUD_HOST&&(this._options.secure=!0),this._options.logFunction&&_.setLogFunction(this._options.logFunction),_.logLevel=this._options.debug||0,this._api=new ns(t),this._socket=this._createServerConnection(),!pe.supports.audioVideo&&!pe.supports.data){this._delayedAbort(W.BrowserIncompatible,"The current browser does not support WebRTC");return}if(r&&!pe.validateId(r)){this._delayedAbort(W.InvalidID,`ID "${r}" is invalid`);return}r?this._initialize(r):this._api.retrieveId().then(s=>this._initialize(s)).catch(s=>this._abort(W.ServerError,s))}_createServerConnection(){const e=new ts(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return e.on(be.Message,t=>{this._handleMessage(t)}),e.on(be.Error,t=>{this._abort(W.SocketError,t)}),e.on(be.Disconnected,()=>{this.disconnected||(this.emitError(W.Network,"Lost connection to server."),this.disconnect())}),e.on(be.Close,()=>{this.disconnected||this._abort(W.SocketClosed,"Underlying socket is already closed.")}),e}_initialize(e){this._id=e,this.socket.start(e,this._options.token)}_handleMessage(e){const t=e.type,r=e.payload,s=e.src;switch(t){case ne.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case ne.Error:this._abort(W.ServerError,r.msg);break;case ne.IdTaken:this._abort(W.UnavailableID,`ID "${this.id}" is taken`);break;case ne.InvalidKey:this._abort(W.InvalidKey,`API KEY "${this._options.key}" is invalid`);break;case ne.Leave:_.log(`Received leave message from ${s}`),this._cleanupPeer(s),this._connections.delete(s);break;case ne.Expire:this.emitError(W.PeerUnavailable,`Could not connect to peer ${s}`);break;case ne.Offer:{const o=r.connectionId;let a=this.getConnection(s,o);if(a&&(a.close(),_.warn(`Offer received for existing Connection ID:${o}`)),r.type===ye.Media){const c=new bt(s,this,{connectionId:o,_payload:r,metadata:r.metadata});a=c,this._addConnection(s,a),this.emit("call",c)}else if(r.type===ye.Data){const c=new this._serializers[r.serialization](s,this,{connectionId:o,_payload:r,metadata:r.metadata,label:r.label,serialization:r.serialization,reliable:r.reliable});a=c,this._addConnection(s,a),this.emit("connection",c)}else{_.warn(`Received malformed connection type:${r.type}`);return}const l=this._getMessages(o);for(const c of l)a.handleMessage(c);break}default:{if(!r){_.warn(`You received a malformed message from ${s} of type ${t}`);return}const o=r.connectionId,a=this.getConnection(s,o);a&&a.peerConnection?a.handleMessage(e):o?this._storeMessage(o,e):_.warn("You received an unrecognized message:",e);break}}}_storeMessage(e,t){this._lostMessages.has(e)||this._lostMessages.set(e,[]),this._lostMessages.get(e).push(t)}_getMessages(e){const t=this._lostMessages.get(e);return t?(this._lostMessages.delete(e),t):[]}connect(e,t={}){if(t={serialization:"default",...t},this.disconnected){_.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError(W.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}const r=new this._serializers[t.serialization](e,this,t);return this._addConnection(e,r),r}call(e,t,r={}){if(this.disconnected){_.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError(W.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!t){_.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}const s=new bt(e,this,{...r,_stream:t});return this._addConnection(e,s),s}_addConnection(e,t){_.log(`add connection ${t.type}:${t.connectionId} to peerId:${e}`),this._connections.has(e)||this._connections.set(e,[]),this._connections.get(e).push(t)}_removeConnection(e){const t=this._connections.get(e.peer);if(t){const r=t.indexOf(e);r!==-1&&t.splice(r,1)}this._lostMessages.delete(e.connectionId)}getConnection(e,t){const r=this._connections.get(e);if(!r)return null;for(const s of r)if(s.connectionId===t)return s;return null}_delayedAbort(e,t){setTimeout(()=>{this._abort(e,t)},0)}_abort(e,t){_.error("Aborting!"),this.emitError(e,t),this._lastServerId?this.disconnect():this.destroy()}destroy(){this.destroyed||(_.log(`Destroy peer with ID:${this.id}`),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))}_cleanup(){for(const e of this._connections.keys())this._cleanupPeer(e),this._connections.delete(e);this.socket.removeAllListeners()}_cleanupPeer(e){const t=this._connections.get(e);if(t)for(const r of t)r.close()}disconnect(){if(this.disconnected)return;const e=this.id;_.log(`Disconnect peer with ID:${e}`),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=e,this._id=null,this.emit("disconnected",e)}reconnect(){if(this.disconnected&&!this.destroyed)_.log(`Attempting reconnection to server with ID ${this._lastServerId}`),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(!this.disconnected&&!this.open)_.error("In a hurry? We're still trying to make the initial connection!");else throw new Error(`Peer ${this.id} cannot reconnect because it is not disconnected from the server!`)}}listAllPeers(e=t=>{}){this._api.listAllPeers().then(t=>e(t)).catch(t=>this._abort(W.ServerError,t))}};Zt=new WeakMap,xe(Xe,Zt,Xe.DEFAULT_KEY="peerjs");let Ft=Xe;var as=Ft,os=Dn;const Ze=br(os);var ot=function(n,e){return n<e?-1:n>e?1:0},gr=function(n){return n.reduce(function(e,t){return e+t},0)},cs=function(){function n(t){this.colors=t}var e=n.prototype;return e.palette=function(){return this.colors},e.map=function(t){return t},n}(),ls=function(){function n(o,a,l){return(o<<10)+(a<<5)+l}function e(o){var a=[],l=!1;function c(){a.sort(o),l=!0}return{push:function(d){a.push(d),l=!1},peek:function(d){return l||c(),d===void 0&&(d=a.length-1),a[d]},pop:function(){return l||c(),a.pop()},size:function(){return a.length},map:function(d){return a.map(d)},debug:function(){return l||c(),a}}}function t(o,a,l,c,d,u,f){var p=this;p.r1=o,p.r2=a,p.g1=l,p.g2=c,p.b1=d,p.b2=u,p.histo=f}function r(){this.vboxes=new e(function(o,a){return ot(o.vbox.count()*o.vbox.volume(),a.vbox.count()*a.vbox.volume())})}function s(o,a){if(a.count()){var l=a.r2-a.r1+1,c=a.g2-a.g1+1,d=Math.max.apply(null,[l,c,a.b2-a.b1+1]);if(a.count()==1)return[a.copy()];var u,f,p,m,S=0,T=[],q=[];if(d==l)for(u=a.r1;u<=a.r2;u++){for(m=0,f=a.g1;f<=a.g2;f++)for(p=a.b1;p<=a.b2;p++)m+=o[n(u,f,p)]||0;T[u]=S+=m}else if(d==c)for(u=a.g1;u<=a.g2;u++){for(m=0,f=a.r1;f<=a.r2;f++)for(p=a.b1;p<=a.b2;p++)m+=o[n(f,u,p)]||0;T[u]=S+=m}else for(u=a.b1;u<=a.b2;u++){for(m=0,f=a.r1;f<=a.r2;f++)for(p=a.g1;p<=a.g2;p++)m+=o[n(f,p,u)]||0;T[u]=S+=m}return T.forEach(function(L,x){q[x]=S-L}),function(L){var x,A,g,M,O,X=L+"1",R=L+"2",y=0;for(u=a[X];u<=a[R];u++)if(T[u]>S/2){for(g=a.copy(),M=a.copy(),O=(x=u-a[X])<=(A=a[R]-u)?Math.min(a[R]-1,~~(u+A/2)):Math.max(a[X],~~(u-1-x/2));!T[O];)O++;for(y=q[O];!y&&T[O-1];)y=q[--O];return g[R]=O,M[X]=g[R]+1,[g,M]}}(d==l?"r":d==c?"g":"b")}}return t.prototype={volume:function(o){var a=this;return a._volume&&!o||(a._volume=(a.r2-a.r1+1)*(a.g2-a.g1+1)*(a.b2-a.b1+1)),a._volume},count:function(o){var a=this,l=a.histo;if(!a._count_set||o){var c,d,u,f=0;for(c=a.r1;c<=a.r2;c++)for(d=a.g1;d<=a.g2;d++)for(u=a.b1;u<=a.b2;u++)f+=l[n(c,d,u)]||0;a._count=f,a._count_set=!0}return a._count},copy:function(){var o=this;return new t(o.r1,o.r2,o.g1,o.g2,o.b1,o.b2,o.histo)},avg:function(o){var a=this,l=a.histo;if(!a._avg||o){var c,d,u,f,p=0,m=0,S=0,T=0;if(a.r1===a.r2&&a.g1===a.g2&&a.b1===a.b2)a._avg=[a.r1<<3,a.g1<<3,a.b1<<3];else{for(d=a.r1;d<=a.r2;d++)for(u=a.g1;u<=a.g2;u++)for(f=a.b1;f<=a.b2;f++)p+=c=l[n(d,u,f)]||0,m+=c*(d+.5)*8,S+=c*(u+.5)*8,T+=c*(f+.5)*8;a._avg=p?[~~(m/p),~~(S/p),~~(T/p)]:[~~(8*(a.r1+a.r2+1)/2),~~(8*(a.g1+a.g2+1)/2),~~(8*(a.b1+a.b2+1)/2)]}}return a._avg},contains:function(o){var a=this,l=o[0]>>3;return gval=o[1]>>3,bval=o[2]>>3,l>=a.r1&&l<=a.r2&&gval>=a.g1&&gval<=a.g2&&bval>=a.b1&&bval<=a.b2}},r.prototype={push:function(o){this.vboxes.push({vbox:o,color:o.avg()})},palette:function(){return this.vboxes.map(function(o){return o.color})},size:function(){return this.vboxes.size()},map:function(o){for(var a=this.vboxes,l=0;l<a.size();l++)if(a.peek(l).vbox.contains(o))return a.peek(l).color;return this.nearest(o)},nearest:function(o){for(var a,l,c,d=this.vboxes,u=0;u<d.size();u++)((l=Math.sqrt(Math.pow(o[0]-d.peek(u).color[0],2)+Math.pow(o[1]-d.peek(u).color[1],2)+Math.pow(o[2]-d.peek(u).color[2],2)))<a||a===void 0)&&(a=l,c=d.peek(u).color);return c},forcebw:function(){var o=this.vboxes;o.sort(function(d,u){return ot(gr(d.color),gr(u.color))});var a=o[0].color;a[0]<5&&a[1]<5&&a[2]<5&&(o[0].color=[0,0,0]);var l=o.length-1,c=o[l].color;c[0]>251&&c[1]>251&&c[2]>251&&(o[l].color=[255,255,255])}},{quantize:function(o,a){if(!Number.isInteger(a)||a<1||a>256)throw new Error("Invalid maximum color count. It must be an integer between 1 and 256.");if(!o.length||a<2||a>256||!o.length||a<2||a>256)return!1;for(var l=[],c=new Set,d=0;d<o.length;d++){var u=o[d],f=u.join(",");c.has(f)||(c.add(f),l.push(u))}if(l.length<=a)return new cs(l);var p=function(x){var A,g=new Array(32768);return x.forEach(function(M){A=n(M[0]>>3,M[1]>>3,M[2]>>3),g[A]=(g[A]||0)+1}),g}(o);p.forEach(function(){});var m=function(x,A){var g,M,O,X=1e6,R=0,y=1e6,P=0,D=1e6,w=0;return x.forEach(function(B){(g=B[0]>>3)<X?X=g:g>R&&(R=g),(M=B[1]>>3)<y?y=M:M>P&&(P=M),(O=B[2]>>3)<D?D=O:O>w&&(w=O)}),new t(X,R,y,P,D,w,A)}(o,p),S=new e(function(x,A){return ot(x.count(),A.count())});function T(x,A){for(var g,M=x.size(),O=0;O<1e3;){if(M>=A||O++>1e3)return;if((g=x.pop()).count()){var X=s(p,g),R=X[0],y=X[1];if(!R)return;x.push(R),y&&(x.push(y),M++)}else x.push(g),O++}}S.push(m),T(S,.75*a);for(var q=new e(function(x,A){return ot(x.count()*x.volume(),A.count()*A.volume())});S.size();)q.push(S.pop());T(q,a);for(var L=new r;q.size();)L.push(q.pop());return L}}}().quantize,cn=function(n){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.width=this.canvas.width=n.naturalWidth,this.height=this.canvas.height=n.naturalHeight,this.context.drawImage(n,0,0,this.width,this.height)};cn.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)};var $e=function(){};$e.prototype.getColor=function(n,e){return e===void 0&&(e=10),this.getPalette(n,5,e)[0]},$e.prototype.getPalette=function(n,e,t){var r=function(l){var c=l.colorCount,d=l.quality;if(c!==void 0&&Number.isInteger(c)){if(c===1)throw new Error("colorCount should be between 2 and 20. To get one color, call getColor() instead of getPalette()");c=Math.max(c,2),c=Math.min(c,20)}else c=10;return(d===void 0||!Number.isInteger(d)||d<1)&&(d=10),{colorCount:c,quality:d}}({colorCount:e,quality:t}),s=new cn(n),o=function(l,c,d){for(var u,f,p,m,S,T=l,q=[],L=0;L<c;L+=d)f=T[0+(u=4*L)],p=T[u+1],m=T[u+2],((S=T[u+3])===void 0||S>=125)&&(f>250&&p>250&&m>250||q.push([f,p,m]));return q}(s.getImageData().data,s.width*s.height,r.quality),a=ls(o,r.colorCount);return a?a.palette():null},$e.prototype.getColorFromUrl=function(n,e,t){var r=this,s=document.createElement("img");s.addEventListener("load",function(){var o=r.getPalette(s,5,t);e(o[0],n)}),s.src=n},$e.prototype.getImageData=function(n,e){var t=new XMLHttpRequest;t.open("GET",n,!0),t.responseType="arraybuffer",t.onload=function(){if(this.status==200){var r=new Uint8Array(this.response);i=r.length;for(var s=new Array(i),o=0;o<r.length;o++)s[o]=String.fromCharCode(r[o]);var a=s.join(""),l=window.btoa(a);e("data:image/png;base64,"+l)}},t.send()},$e.prototype.getColorAsync=function(n,e,t){var r=this;this.getImageData(n,function(s){var o=document.createElement("img");o.addEventListener("load",function(){var a=r.getPalette(o,5,t);e(a[0],this)}),o.src=s})};const ds={capitalize:n=>n.length===0?n:n.charAt(0).toUpperCase()+n.slice(1)},Lt={rgb:{toHsl:(n,e,t)=>{n/=255,e/=255,t/=255;const r=Math.max(n,e,t),s=Math.min(n,e,t);let o=0,a=0,l=(r+s)/2;if(r!==s){const c=r-s;switch(a=l>.5?c/(2-r-s):c/(r+s),r){case n:o=(e-t)/c+(e<t?6:0);break;case e:o=(t-n)/c+2;break;case t:o=(n-e)/c+4;break}o/=6}return[o*360,a,l]}},hsl:{darken:([n,e,t],r=.3)=>[n,e,Math.max(0,t-r)],toCSS:([n,e,t])=>`hsl(${n.toFixed(0)}, ${(e*100).toFixed(0)}%, ${(t*100).toFixed(0)}%)`,toHex:(n,e,t)=>{const r=e*Math.min(t,1-t),s=d=>{const u=(d+n/30)%12;return t-r*Math.max(-1,Math.min(Math.min(u-3,9-u),1))},o=d=>Math.round(255*s(d)).toString(16).padStart(2,"0"),a=o(0),l=o(8),c=o(4);return`#${a}${l}${c}`}}};function ui(n,e,t,{enumerable:r=!0,writable:s=!1}={}){Object.defineProperty(n,e,{configurable:!0,enumerable:r,get(){try{const o=t.call(this);if(o instanceof Promise){const a=o.then(l=>(Object.defineProperty(this,e,{value:l,writable:s,configurable:!0,enumerable:r}),l),l=>{throw delete this[e],l});return Object.defineProperty(this,e,{value:a,writable:!1,configurable:!0,enumerable:r}),a}else return Object.defineProperty(this,e,{value:o,writable:s,configurable:!0,enumerable:r}),o}catch(o){throw o}}})}const us=new $e,h=Te({init:!1,queue:[],qi:0,playing:!1,controls:{loop:!1,shuffle:!1},fetch:0,t:0,dur:0,audioElm:new Audio,meta:{id:"",title:"Nothing playing",img:"",artist:"",album:"",colors:{primary:"#7008e7",secondary:"#7008e7"},lyrics:{type:"plain",content:[],id:0}}}),v={get info(){return h},meta:{init:()=>{"mediaSession"in navigator&&(navigator.mediaSession.setActionHandler("play",()=>{v.playback.resume()}),navigator.mediaSession.setActionHandler("pause",()=>{v.playback.pause()}),navigator.mediaSession.setActionHandler("seekbackward",()=>{h.audioElm.currentTime-=10}),navigator.mediaSession.setActionHandler("seekforward",()=>{h.audioElm.currentTime+=10}),navigator.mediaSession.setActionHandler("previoustrack",v.playback.previous),navigator.mediaSession.setActionHandler("nexttrack",v.playback.next),navigator.mediaSession.setActionHandler("stop",()=>{h.audioElm.pause(),v.info.playing=!1}))},sync:()=>{"mediaSession"in navigator&&(navigator.mediaSession.metadata=new MediaMetadata({title:h.meta.title,artist:h.meta.artist,album:h.meta.album,artwork:[{src:h.meta.img,sizes:"150x150",type:"image/png"}]}))}},playback:{play:async(n,e,t=!0)=>{h.init===!1&&(h.init=!0,v.meta.init()),t&&(h.queue=[...h.queue,{url:e,meta:n}],h.qi=h.queue.length-1,I.jam.active&&(I.jam.queue=h.queue,I.jam.currentTrackIndex=h.qi,Se.playback.broadcastQueueUpdate(h.queue))),e=e.replace("http://","https://"),h.meta={...h.meta,...n};{const r=new Image;r.addEventListener("load",function(){const s=us.getColor(r,5);let o=Lt.rgb.toHsl(...s);h.meta.colors.secondary=Lt.hsl.toHex(...o),o[2]=.3;const a=Lt.hsl.toHex(...o);h.meta.colors.primary=a}),r.crossOrigin="Anonymous",r.src=h.meta.img}h.audioElm.load(),h.audioElm.pause(),h.audioElm.src=e,h.audioElm.controls=!0,h.fetch=0,h.dur=0,h.t=0,h.audioElm.onloadedmetadata=()=>{h.dur=h.audioElm.duration,v.playback.loadLyrics(),I.jam.active&&(I.jam.currentTrackIndex=h.qi,I.jam.duration=h.dur,I.jam.playing=!0,Se.playback.broadcastTrackChange(h.queue[h.qi],h.qi,h.dur))},h.audioElm.play().catch(r=>console.error("Playback failed:",r)),h.audioElm.currentTime=0,h.audioElm.ontimeupdate=()=>{h.t=h.audioElm.currentTime,I.jam.active&&(I.jam.currentTime=h.t)},h.audioElm.onprogress=()=>{const r=h.audioElm.buffered,s=h.audioElm.duration;if(r.length>0&&s>0){const o=r.end(r.length-1);h.fetch=o/s*100}},h.audioElm.onended=()=>{v.playback.next()},v.info.playing=!0,v.meta.sync()},seekTo:(n,e=!0)=>{n<0&&(n=0),n>h.dur&&(n=h.dur),h.audioElm.currentTime=n,h.t=n,I.jam.active&&e&&!I.jam.isSyncing&&(I.jam.currentTime=n,Se.playback.broadcastSeek(n))},appendQueue:async(n,e)=>{e=e.replace("http://","https://"),h.queue=[...h.queue,{url:e,meta:n}],I.jam.active&&(I.jam.queue=h.queue,Se.playback.broadcastQueueUpdate(h.queue))},loadLyrics:()=>{const n=h.meta.title?h.meta.title.trim().toLowerCase():"",e=h.meta.album?h.meta.album.trim().toLowerCase():"",t=h.meta.artist?h.meta.artist.trim().toLowerCase():"";fetch(`https://lrclib.net/api/search?track_name=${encodeURIComponent(h.meta.title)}`).then(r=>r.json()).then(r=>{if(!Array.isArray(r)||r.length===0){console.warn("No lyrics found.");return}const s=r.filter(c=>c.syncedLyrics&&c.syncedLyrics.trim()!=="");if(s.length===0){console.warn("No candidates with synced lyrics found.");return}const o=s.filter(c=>{const d=(c.title||c.name||c.trackName||"").trim().toLowerCase(),u=(c.album||c.albumName||"").trim().toLowerCase();let f="";return c.artist?f=c.artist.trim().toLowerCase():c.artistName?f=c.artistName.trim().toLowerCase():c.artistMap&&c.artistMap.primary_artists&&c.artistMap.primary_artists.length&&(f=c.artistMap.primary_artists[0].name.trim().toLowerCase()),d===n&&u===e&&f===t});let a;o.length>0?a=o.reduce((c,d)=>Math.abs(d.duration-h.dur)<Math.abs(c.duration-h.dur)?d:c):a=s.map(m=>{let S=Math.abs(m.duration-h.dur)*1;const T=(m.title||m.name||m.trackName||"").trim().toLowerCase(),q=(m.album||m.albumName||"").trim().toLowerCase();let L="";return m.artist?L=m.artist.trim().toLowerCase():m.artistName?L=m.artistName.trim().toLowerCase():m.artistMap&&m.artistMap.primary_artists&&m.artistMap.primary_artists.length&&(L=m.artistMap.primary_artists[0].name.trim().toLowerCase()),e&&q!==e&&(S+=20),t&&L!==t&&(S+=20),n&&T!==n&&(S+=20),{candidate:m,score:S}}).reduce((m,S)=>S.score<m.score?S:m).candidate;const l=a.syncedLyrics.split(`
`).map(c=>{const d=/^\[(\d{2}):(\d{2}\.\d{2})\]\s*(.*)$/.exec(c);if(d){const u=parseInt(d[1],10),f=parseFloat(d[2]);return{time:u*60+f,text:d[3]}}return{time:0,text:c}}).filter(c=>c.text&&c.text.trim()!=="");h.meta.lyrics={type:"synced",content:l,id:a.id}}).catch(r=>console.error("Lyrics fetch failed:",r))},pause:()=>{h.audioElm.pause(),v.info.playing=!1,I.jam.active&&!I.jam.isSyncing&&(I.jam.playing=!1,Se.playback.broadcastPause())},resume:()=>{h.audioElm.play().catch(n=>console.error("Resume failed:",n)),v.info.playing=!0,I.jam.active&&!I.jam.isSyncing&&(I.jam.playing=!0,Se.playback.broadcastResume())},next:()=>{h.qi<h.queue.length-1?(h.qi++,v.playback.play(h.queue[h.qi].meta,h.queue[h.qi].url,!1)):h.controls.loop&&(h.qi=0,v.playback.play(h.queue[h.qi].meta,h.queue[h.qi].url,!1))},previous:()=>{h.qi>0&&(h.qi--,v.playback.play(h.queue[h.qi].meta,h.queue[h.qi].url,!1))},getCurrent:()=>h.queue[h.qi]},helpers:{decryptURL:n=>{if(!n)return[];const e="38346591",t="00000000",r=Ze.util.decode64(n),s=Ze.cipher.createDecipher("DES-ECB",Ze.util.createBuffer(e));s.start({iv:Ze.util.createBuffer(t)}),s.update(Ze.util.createBuffer(r)),s.finish();const o=s.output.getBytes();return[{quality:"12kbps",url:o.replace("_96","_12")},{quality:"48kbps",url:o.replace("_96","_48")},{quality:"96kbps",url:o},{quality:"160kbps",url:o.replace("_96","_160")},{quality:"320kbps",url:o.replace("_96","_320")}]}}};var fs=z('<button class="text-red-500 select-none" aria-label="close jam session" title="End JAM Session"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="h-[1.5em]"><path fill-rule="evenodd" d="M7.5 3.75A1.5 1.5 0 0 0 6 5.25v13.5a1.5 1.5 0 0 0 1.5 1.5h6a1.5 1.5 0 0 0 1.5-1.5V15a.75.75 0 0 1 1.5 0v3.75a3 3 0 0 1-3 3h-6a3 3 0 0 1-3-3V5.25a3 3 0 0 1 3-3h6a3 3 0 0 1 3 3V9A.75.75 0 0 1 15 9V5.25a1.5 1.5 0 0 0-1.5-1.5h-6Zm5.03 4.72a.75.75 0 0 1 0 1.06l-1.72 1.72h10.94a.75.75 0 0 1 0 1.5H10.81l1.72 1.72a.75.75 0 1 1-1.06 1.06l-3-3a.75.75 0 0 1 0-1.06l3-3a.75.75 0 0 1 1.06 0Z" clip-rule="evenodd"></path></svg></button>'),ps=z('<span class="text-black/50 dark:text-white/50"> </span> JAM Session',1),hs=z('<span class="text-black/50 dark:text-white/50 text-sm"> </span> ',1),ms=z('<div class="flex flex-row items-center justify-center w-full"><!> <h1 class="text-black dark:text-white select-none truncate max-w-[60dvw]"><!></h1></div>'),gs=z(`<input type="text" name="room title" id="room title" placeholder="Session Name, e.g., Varun's Party Music" class="bg-white/5 border-hidden ring-0 focus:outline-hidden rounded-md py-1 px-2 text-white"/>`),vs=Ve('<path fill-rule="evenodd" d="M4.755 10.059a7.5 7.5 0 0 1 12.548-3.364l1.903 1.903h-3.183a.75.75 0 1 0 0 1.5h4.992a.75.75 0 0 0 .75-.75V4.356a.75.75 0 0 0-1.5 0v3.18l-1.9-1.9A9 9 0 0 0 3.306 9.67a.75.75 0 1 0 1.45.388Zm15.408 3.352a.75.75 0 0 0-.919.53 7.5 7.5 0 0 1-12.548 3.364l-1.902-1.903h3.183a.75.75 0 0 0 0-1.5H2.984a.75.75 0 0 0-.75.75v4.992a.75.75 0 0 0 1.5 0v-3.18l1.9 1.9a9 9 0 0 0 15.059-4.035.75.75 0 0 0-.53-.918Z" clip-rule="evenodd"></path>'),bs=Ve('<path fill-rule="evenodd" d="M9 4.5a.75.75 0 0 1 .721.544l.813 2.846a3.75 3.75 0 0 0 2.576 2.576l2.846.813a.75.75 0 0 1 0 1.442l-2.846.813a3.75 3.75 0 0 0-2.576 2.576l-.813 2.846a.75.75 0 0 1-1.442 0l-.813-2.846a3.75 3.75 0 0 0-2.576-2.576l-2.846-.813a.75.75 0 0 1 0-1.442l2.846-.813A3.75 3.75 0 0 0 7.466 7.89l.813-2.846A.75.75 0 0 1 9 4.5ZM18 1.5a.75.75 0 0 1 .728.568l.258 1.036c.236.94.97 1.674 1.91 1.91l1.036.258a.75.75 0 0 1 0 1.456l-1.036.258c-.94.236-1.674.97-1.91 1.91l-.258 1.036a.75.75 0 0 1-1.456 0l-.258-1.036a2.625 2.625 0 0 0-1.91-1.91l-1.036-.258a.75.75 0 0 1 0-1.456l1.036-.258a2.625 2.625 0 0 0 1.91-1.91l.258-1.036A.75.75 0 0 1 18 1.5ZM16.5 15a.75.75 0 0 1 .712.513l.394 1.183c.15.447.5.799.948.948l1.183.395a.75.75 0 0 1 0 1.422l-1.183.395c-.447.15-.799.5-.948.948l-.395 1.183a.75.75 0 0 1-1.422 0l-.395-1.183a1.5 1.5 0 0 0-.948-.948l-1.183-.395a.75.75 0 0 1 0-1.422l1.183-.395c.447-.15.799-.5.948-.948l.395-1.183A.75.75 0 0 1 16.5 15Z" clip-rule="evenodd"></path>'),ys=z(`<p class="text-black dark:text-white text-sm select-none">JAM Sessions let you and your friends enjoy music together, no matter
        where you are in the world. <span class=" text-black/50 dark:text-white/50">Your client ID is unique to your browser. If you switch browsers,
          you'll need to start a new session, as your previous one cannot be
          resumed.</span></p> <div class="flex flex-col space-y-2 w-[95dvw] mt-[5dvh]"><p class="text-red-500 text-xs"> </p> <div class="text-white flex flex-row items-center bg-white/5 rounded-md"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="h-[1.2em] ml-2"><path fill-rule="evenodd" d="M17.834 6.166a8.25 8.25 0 1 0 0 11.668.75.75 0 0 1 1.06 1.06c-3.807 3.808-9.98 3.808-13.788 0-3.808-3.807-3.808-9.98 0-13.788 3.807-3.808 9.98-3.808 13.788 0A9.722 9.722 0 0 1 21.75 12c0 .975-.296 1.887-.809 2.571-.514.685-1.28 1.179-2.191 1.179-.904 0-1.666-.487-2.18-1.164a5.25 5.25 0 1 1-.82-6.26V8.25a.75.75 0 0 1 1.5 0V12c0 .682.208 1.27.509 1.671.3.401.659.579.991.579.332 0 .69-.178.991-.579.3-.4.509-.99.509-1.671a8.222 8.222 0 0 0-2.416-5.834ZM15.75 12a3.75 3.75 0 1 0-7.5 0 3.75 3.75 0 0 0 7.5 0Z" clip-rule="evenodd"></path></svg> <input type="text" name="username" id="username" placeholder="Username" class="bg-transparent border-hidden ring-0 focus:outline-hidden w-full py-1 pr-2"/></div> <!> <p class="text-zinc-500 flex flex-row items-center space-x-2 h-[2ch] overflow-hidden"><span class="text-xs">room-id:</span> <span class="truncate w-[75dvw] inline-block text-xs whitespace-nowrap"> </span></p> <button class="text-white disabled:brightness-75 bg-purple-500 rounded-md font-bold select-none"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><!></svg> </button></div>`,1),_s=z('<p><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="h-[0.8em] inline -mr-1"><path fill-rule="evenodd" d="M17.834 6.166a8.25 8.25 0 1 0 0 11.668.75.75 0 0 1 1.06 1.06c-3.807 3.808-9.98 3.808-13.788 0-3.808-3.807-3.808-9.98 0-13.788 3.807-3.808 9.98-3.808 13.788 0A9.722 9.722 0 0 1 21.75 12c0 .975-.296 1.887-.809 2.571-.514.685-1.28 1.179-2.191 1.179-.904 0-1.666-.487-2.18-1.164a5.25 5.25 0 1 1-.82-6.26V8.25a.75.75 0 0 1 1.5 0V12c0 .682.208 1.27.509 1.671.3.401.659.579.991.579.332 0 .69-.178.991-.579.3-.4.509-.99.509-1.671a8.222 8.222 0 0 0-2.416-5.834ZM15.75 12a3.75 3.75 0 1 0-7.5 0 3.75 3.75 0 0 0 7.5 0Z" clip-rule="evenodd"></path></svg> </p>'),ks=z('<p class="text-xs ml-auto"> </p>'),Cs=z('<div><!> <p class="px-2 text-white -mt-[0.2em] text-base"> </p> <!></div>'),xs=z('<div class="w-dvw h-[80dvh] max-h-[70dvh] overflow-y-scroll overflow-x-hidden text-white ring-1 ring-white/5 mb-2"><div class="sticky top-0 flex flex-row justify-end border-b-0 w-dvw h-[5dvh]"><button aria-label="copy session invite link" class="w-[15%] flex flex-col items-center justify-center rounded-bl-md overflow-hidden p-0 m-0 max-h-[3em] select-none bg-linear-to-b from-black/10 dark:from-white/10 to-black/5 dark:to-white/5 backdrop-blur-3xl"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="text-violet-500 aspect-square p-[0.1em] h-[2em] inline-block"><path fill-rule="evenodd" d="M15.75 4.5a3 3 0 1 1 .825 2.066l-8.421 4.679a3.002 3.002 0 0 1 0 1.51l8.421 4.679a3 3 0 1 1-.729 1.31l-8.421-4.678a3 3 0 1 1 0-4.132l8.421-4.679a3 3 0 0 1-.096-.755Z" clip-rule="evenodd"></path></svg></button></div> <!></div> <div class="text-white flex flex-row items-center bg-white/5 rounded-md w-[95dvw]"><input type="text" name="message" id="message" placeholder="send a message" class="bg-transparent border-hidden ring-0 focus:outline-hidden w-full py-1 pl-2"/> <button class="p-0 m-0 select-none" aria-label="send message"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="h-[1.2em] mr-2"><path d="M3.478 2.404a.75.75 0 0 0-.926.941l2.432 7.905H13.5a.75.75 0 0 1 0 1.5H4.984l-2.432 7.905a.75.75 0 0 0 .926.94 60.519 60.519 0 0 0 18.445-8.986.75.75 0 0 0 0-1.218A60.517 60.517 0 0 0 3.478 2.404Z"></path></svg></button></div>',1);function Ss(n,e){Ne(e,!0);let t=gt(e,"visible",15,!1),r=gt(e,"info",19,()=>({create:!0,roomId:""})),s=Te({username:"",sessionName:"",warning:"",pendingOp:!1}),o=we(void 0),a=we(void 0),l=Te(new Set),c=Te({connected:!1,activity:"",id:"",clientid:"",name:"",messages:[]});je(()=>{var x;c.messages,(x=b(o))==null||x.scrollTo({top:b(o).scrollHeight,behavior:"smooth"})}),je(()=>{t()&&!b(a)&&(he(a,new as({config:{iceServers:[{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"},{urls:"stun:stun4.l.google.com:19302"}]}}),!0),b(a).on("open",x=>{c.clientid=x,r().create?c.id=x:c.id=r().roomId,I.peer=b(a)}),b(a).on("connection",u),b(a).on("close",()=>{}),b(a).on("disconnected",()=>{}),b(a).on("error",()=>{}),r().create&&Se.playback.startHeartbeat())});let d=!1;je(()=>{if(d)return;d=!0;const x=A=>{const g=A.detail,M=v.info;if(I.jam.active){I.jam.isSyncing=!0;try{if(g.type==="queue_update"&&g.queue&&JSON.stringify(M.queue)!==JSON.stringify(g.queue)&&(M.queue=g.queue,I.jam.queue=g.queue),g.type==="play"&&g.queue&&g.currentTrackIndex!==void 0){const O=g.queue[g.currentTrackIndex];O&&(M.qi!==g.currentTrackIndex||!M.meta.id||M.meta.id!==O.meta.id?(M.qi=g.currentTrackIndex,v.playback.play(O.meta,O.url,!1)):g.playing!==void 0&&(g.playing&&!M.playing?v.playback.resume():!g.playing&&M.playing&&v.playback.pause()),g.currentTime!==void 0&&Math.abs(M.t-g.currentTime)>2&&v.playback.seekTo(g.currentTime,!1))}else g.type==="pause"&&M.playing?v.playback.pause():g.type==="play"&&g.playing&&!M.playing&&!g.queue?v.playback.resume():g.type==="seek"&&g.currentTime!==void 0&&Math.abs(M.t-g.currentTime)>2&&v.playback.seekTo(g.currentTime,!1)}finally{setTimeout(()=>{I.jam.isSyncing=!1},100)}}};return window.addEventListener("jamPlaybackSync",x),()=>{window.removeEventListener("jamPlaybackSync",x)}}),vt(()=>()=>{var x;l.forEach(A=>A.close()),(x=b(a))==null||x.destroy(),Se.playback.stopHeartbeat()});function u(x){var A;l.add(x),x.on("open",()=>{}),x.on("close",()=>{}),x.on("error",()=>{}),I.connections.add(x),r().create&&x.once("open",()=>{if(x.send({type:"meta",roomname:c.name}),I.jam.active&&I.jam.queue.length>0){const g=v.info;x.send({messageType:"playback",subtype:"play",queue:g.queue,currentTrackIndex:g.qi,currentTime:g.t,duration:g.dur,playing:g.playing,initiatedBy:I.user.id})}}),c.messages=[...c.messages,{username:"server",content:`${((A=x.metadata)==null?void 0:A.username)||"A user"} has connected`,time:String(Date.now()/1e3)}],f(),x.on("data",g=>{g.type==="msg"&&(c.messages=[...c.messages,{username:g.username,content:g.content,time:String(Date.now()/1e3)}]),g.type=="meta"&&(c.name=g.roomname),g.messageType==="heartbeat"&&(Math.abs(I.jam.currentTime-g.currentTime)>3&&window.dispatchEvent(new CustomEvent("jamPlaybackSync",{detail:{type:"seek",currentTime:g.currentTime}})),g.playing!==void 0&&I.jam.playing!==g.playing&&window.dispatchEvent(new CustomEvent("jamPlaybackSync",{detail:{type:g.playing?"play":"pause",playing:g.playing}}))),g.messageType==="playback"&&window.dispatchEvent(new CustomEvent("jamPlaybackSync",{detail:{type:g.subtype,queue:g.queue,currentTrackIndex:g.currentTrackIndex,currentTime:g.currentTime,duration:g.duration,playing:g.playing,initiatedBy:g.initiatedBy}}))}),x.on("close",()=>{var g;l.delete(x),I.connections.delete(x),c.messages=[...c.messages,{username:"server",content:`${((g=x.metadata)==null?void 0:g.username)||"A user"} has disconnected`,time:String(Date.now()/1e3)}],f()})}function f(){c.activity=`(${l.size+1})`}const p=()=>{if(s.username=s.username.trim(),s.username.length<4){s.warning="username must be more than 3 characters in length";return}s.sessionName.length==0&&(s.sessionName=`${s.username}'s session`),s.pendingOp=!0,c.name=s.sessionName,c.connected=!0,f(),I.user.name=s.username,I.jam.active=!0,c.messages=[...c.messages,{username:"svara",content:"created session successfully, invite your friends",time:String(Date.now()/1e3)}],s.pendingOp=!1},m=()=>{if(!r().roomId){s.warning="room id is required";return}if(s.username=s.username.trim(),s.username.length<4){s.warning="username must be more than 3 characters in length";return}if(!r().roomId||!b(a)){s.warning="Invalid room ID or peer not initialized";return}s.pendingOp=!0,I.user.name=s.username,I.jam.active=!0;const x=b(a).connect(r().roomId,{metadata:{username:s.username}});x.on("open",()=>{u(x),c.connected=!0,c.name="Untitled Session",f(),c.messages=[...c.messages,{username:"svara",content:"joined session successfully, invite your friends",time:String(Date.now()/1e3)}],s.pendingOp=!1})},S=()=>{I.jam.active=!1;const x={type:"session_close",username:"server",content:`${s.username} has closed the session`,time:String(Date.now()/1e3)};l.forEach(A=>{A.send(x),A.close()}),l.clear(),I.connections.clear(),Se.playback.stopHeartbeat(),r().create&&b(a)&&(b(a).destroy(),he(a,void 0),I.peer=void 0),c.connected=!1,c.messages=[],s.username="",s.sessionName="",s.warning="",t(!1)},T=()=>{if(!b(L).length)return;const x={type:"msg",username:s.username,content:b(L),time:String(Date.now()/1e3)};c.messages=[...c.messages,x],l.forEach(A=>{A.send(x)}),he(L,"")},q=()=>{navigator.clipboard.writeText(`${window.location.host+window.location.pathname}#join${c.id}`),c.messages=[...c.messages,{username:"svara",content:"invite copied to clipboard",time:String(Date.now()/1e3)}]};let L=we("");In(n,{id:"jam-entry",get visible(){return t()},set visible(g){t(g)},title:g=>{var M=ms(),O=k(M);{var X=w=>{var B=fs();B.__click=()=>S(),E(w,B)};Z(O,w=>{c.connected&&w(X)})}var R=C(O,2),y=k(R);{var P=w=>{var B=ps(),V=me(B),U=k(V);re(()=>ce(U,r().create?"Create:":"Join:")),E(w,B)},D=w=>{var B=hs(),V=me(B),U=k(V),H=C(V);re(()=>{ce(U,c.activity),ce(H,` ${c.name??""}`)}),E(w,B)};Z(y,w=>{c.connected?w(D,!1):w(P)})}E(g,M)},body:g=>{var M=We(),O=me(M);{var X=y=>{var P=ys(),D=C(me(P),2),w=k(D),B=k(w),V=C(w,2),U=C(k(V),2),H=C(V,2);{var K=j=>{var ee=gs();lt(ee,()=>s.sessionName,se=>s.sessionName=se),E(j,ee)};Z(H,j=>{r().create&&j(K)})}var N=C(H,2),G=C(k(N),2),oe=k(G),ue=C(N,2);ue.__click=()=>{r().create?p():m()};var Q=k(ue),fe=k(Q);{var ge=j=>{var ee=vs();E(j,ee)},_e=j=>{var ee=bs();E(j,ee)};Z(fe,j=>{s.pendingOp?j(ge):j(_e,!1)})}var J=C(Q);re(()=>{ce(B,s.warning),ce(oe,c.id),ue.disabled=s.pendingOp,qe(ue,"aria-label",`${r().create?"create":"join"} jam session`),ve(Q,0,`h-[1em] inline ${s.pendingOp?"animate-spin":""}`),ce(J,` ${r().create?"create":"join"}`)}),lt(U,()=>s.username,j=>s.username=j),E(y,P)},R=y=>{var P=xs(),D=me(P),w=k(D),B=k(w);B.__click=()=>q();var V=C(w,2);nt(V,17,()=>c.messages,st,(N,G,oe)=>{var ue=Cs(),Q=k(ue);{var fe=ee=>{var se=_s(),ke=C(k(se));re(Me=>{ve(se,1,`${Me??""} text-lg font-medium px-0.5 rounded-r-md inline-block max-w-[95%] truncate`),ce(ke,` ${b(G).username??""}`)},[()=>["server","svara"].includes(b(G).username)?"text-red-400":"text-purple-400"]),E(ee,se)};Z(Q,ee=>{var se;((se=c.messages[oe-1])==null?void 0:se.username)!==b(G).username&&ee(fe)})}var ge=C(Q,2),_e=k(ge),J=C(ge,2);{var j=ee=>{var se=ks(),ke=k(se);re(Me=>ce(ke,Me),[()=>new Date(Number(b(G).time)*1e3).toLocaleTimeString(void 0,{hour:"numeric",minute:"2-digit",hour12:!0})]),E(ee,se)};Z(J,ee=>{b(G).time&&ee(j)})}re(()=>{ve(ue,1,`${b(G).username==s.username?"ml-auto rounded-br-none mr-1":"rounded-bl-none ml-1"} ${oe-1!==-1&&c.messages[oe-1].username===b(G).username?"mt-[0.25em]":"mt-[0.5em]"} rounded-lg p-1 bg-white/5 flex flex-col items-start justify-center w-fit min-w-[20dvw] max-w-[80dvw]`),ce(_e,b(G).content)}),E(N,ue)}),vr(D,N=>he(o,N),()=>b(o));var U=C(D,2),H=k(U);H.__keyup=N=>{N.key=="Enter"&&T()};var K=C(H,2);K.__click=()=>T(),lt(H,()=>b(L),N=>he(L,N)),E(y,P)};Z(O,y=>{c.connected?y(R,!1):y(X)})}E(g,M)},$$slots:{title:!0,body:!0}}),Fe()}He(["click","keyup"]);var Ts=z('<img alt="cover art" class="size-6 rounded-lg" loading="lazy"/>'),Rs=z('<li class="flex flex-row space-x-2 border-b-1 border-black/20 dark:border-white/20 first:border-b-0 py-2 px-1"><!> <p class="text-md truncate min-w-[75%]"> </p> <!></li>'),Ps=z(`<li><p>You haven't created any playlists yet. <span class="text-white/50">Start by creating a playlist to organize and access your songs
              effortlessly.</span></p></li>`),Es=z('<img alt="cover art" class="size-6 rounded-lg" loading="lazy"/>'),ws=z('<li class="flex flex-row space-x-2 border-b-1 border-black/20 dark:border-white/20 first:border-b-0 py-2 px-1"><!> <p class="text-md truncate min-w-[75%]"> </p> <!></li>'),Ms=z('<button class="absolute top-0 w-full h-[25dvh]" aria-label="close sheet"></button> <div class="flex flex-col absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 h-[50dvh] w-[95dvw] px-2 bg-panel rounded-lg text-md text-black dark:text-white"><p class="w-full text-center text-lg font-medium mb-[1ch] py-1">Select playlist</p> <div class="flex flex-row items-center justify-around space-x-2"><div class="w-full max-w-120 relative"><input type="text" autocomplete="off" spellcheck="false" id="playlist-name-input" class="p-0.5 px-2 pt-3 border-hidden w-full text-[16px] text-black dark:text-white bg-transparent rounded-lg ring-1 ring-black/50 dark:ring-white/50 invalid:ring-red-600 dark:invalid:ring-red-500 dark:focus:ring-blue-500 focus:outline-hidden focus:ring-blue-600 peer appearance-none" placeholder=" "/> <label for="playlist-name-input" class="absolute text-sm text-black/75 dark:text-white/75 duration-300 transform -translate-y-4 scale-[85%] px-1.5 top-2 z-10 origin-[0] bg-gray-200 dark:bg-zinc-900 peer-focus:px-1.5 peer-focus:text-blue-600 dark:peer-focus:text-blue-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 peer-focus:top-2 peer-focus:scale-[85%] peer-focus:-translate-y-4 peer-focus:rtl:translate-x-1/4 peer-focus:rtl:left-auto start-1">playlist name</label></div> <button class="bg-blue-500 dark:bg-blue-400 text-white dark:text-black rounded-md disabled:bg-black/50 dark:disabled:bg-white/50">create</button></div> <ul class="mt-[1ch] space-y-1 overflow-y-scroll flex flex-col-reverse"><!></ul></div> <button class="absolute bottom-0 w-full h-[25dvh]" aria-label="close sheet"></button>',1);function Is(n,e){Ne(e,!0);const t=()=>Ct(te,"$ViewInfo",r),[r,s]=xt();let o=we(""),a=we(Te([])),l=Ie(()=>b(a).filter(R=>R.title.toLowerCase().includes(b(o).trim().toLowerCase()))),c=Ie(()=>b(l).length==0&&b(o).trim()!=""),d=Ie(()=>b(o).trim()==""?!1:!!(b(c)||b(a).filter(R=>R.title==b(o)).length==0));vt(()=>{he(a,it.playlist.getAll().map(R=>{let y=!1;return R.tracks.length>0&&R.tracks.find(P=>P.meta.id==t().select.track.meta.id)&&(y=!0),{...R,selected:y}}),!0)});const u=async()=>{he(o,b(o).trim(),!0),it.playlist.create(b(o),"",[t().select.track]),Mt(`<i>${t().select.track.meta.title}</i><br/>added to <i>${b(o)}</i>`),le(te,$(t).sheets.selectPlaylist=!1,$(t)),le(te,$(t).sheets.actions=!1,$(t))},f=()=>{b(l).forEach(async R=>{const y=R.tracks.find(P=>P.meta.id==t().select.track.meta.id);R.selected&&y||!R.selected&&!y||(R.selected&&!y?(it.playlist.add(R.id,t().select.track),Mt(`<i>${t().select.track.meta.title}</i><br/>added to <i>${R.title}</i>`)):!R.selected&&y&&(it.playlist.remove(R.id,t().select.track.meta.id),Mt(`<i>${t().select.track.meta.title}</i><br/>removed from <i>${R.title}</i>`)))}),le(te,$(t).sheets.selectPlaylist=!1,$(t)),le(te,$(t).sheets.actions=!1,$(t))};var p=Ms(),m=me(p);m.__click=f;var S=C(m,2),T=C(k(S),2),q=k(T),L=k(q),x=C(q,2);x.__click=u;var A=C(T,2),g=k(A);{var M=R=>{var y=We(),P=me(y);nt(P,17,()=>b(l),st,(D,w,B)=>{const V=Ie(()=>b(w).tracks.length!==0?b(w).tracks[0].meta.img:void 0);var U=Rs(),H=k(U);{var K=Q=>{var fe=Ts();re(()=>qe(fe,"src",b(V))),E(Q,fe)},N=Q=>{ir(Q,{class:"size-6"})};Z(H,Q=>{b(V)?Q(K):Q(N,!1)})}var G=C(H,2),oe=k(G),ue=C(G,2);sr(ue,{class:"text-violet-700 ring-0 size-6 text-xl ml-auto",get checked(){return b(w).selected},set checked(Q){b(w).selected=Q}}),re(()=>ce(oe,b(w).title)),E(D,U)},D=>{var w=Ps();E(D,w)}),E(R,y)},O=R=>{const y=Ie(()=>t().select.track.meta.img);var P=ws(),D=k(P);{var w=K=>{var N=Es();re(()=>qe(N,"src",b(y))),E(K,N)},B=K=>{ir(K,{class:"size-6"})};Z(D,K=>{b(y)?K(w):K(B,!1)})}var V=C(D,2),U=k(V),H=C(V,2);sr(H,{checked:!0,disabled:!0,class:"text-violet-700 ring-0 size-6 text-xl ml-auto"}),re(()=>ce(U,b(o))),E(R,P)};Z(g,R=>{b(c)?R(O,!1):R(M)})}var X=C(S,2);X.__click=f,re(()=>x.disabled=!b(d)),lt(L,()=>b(o),R=>he(o,R)),F(3,S,()=>At,()=>({axis:"y",duration:200})),E(n,p),Fe(),s()}He(["click"]);var Ds=z('<button aria-label="close sheet" class="w-screen h-[70dvh] bottom-[30dvh]"></button> <div class="absolute bottom-0 left-1/2 -translate-x-1/2 h-[30dvh] w-[95dvw] bg-panel rounded-t-lg text-md"><p class="w-full text-center text-lg font-medium text-black dark:text-white py-1 border-b-1 border-black/20 dark:border-white/20">Actions</p> <button class="bottom-[calc(30dvh-1.725rem)] p-0 absolute right-[1ch]" aria-label="close sheet"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="size-6 dark:fill-white fill-black"><path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25Zm-1.72 6.97a.75.75 0 1 0-1.06 1.06L10.94 12l-1.72 1.72a.75.75 0 1 0 1.06 1.06L12 13.06l1.72 1.72a.75.75 0 1 0 1.06-1.06L13.06 12l1.72-1.72a.75.75 0 1 0-1.06-1.06L12 10.94l-1.72-1.72Z" clip-rule="evenodd"></path></svg></button> <ul class="more-actions-sheet-ul text-black dark:text-white"><li><button class="w-full text-left"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-[1.2em] inline mr-2 ml-4"><path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25ZM12.75 9a.75.75 0 0 0-1.5 0v2.25H9a.75.75 0 0 0 0 1.5h2.25V15a.75.75 0 0 0 1.5 0v-2.25H15a.75.75 0 0 0 0-1.5h-2.25V9Z" clip-rule="evenodd"></path></svg> Add to queue</button></li> <li><button class="w-full text-left"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-[1.2em] inline mr-2 ml-4"><path fill-rule="evenodd" d="M19.5 21a3 3 0 0 0 3-3V9a3 3 0 0 0-3-3h-5.379a.75.75 0 0 1-.53-.22L11.47 3.66A2.25 2.25 0 0 0 9.879 3H4.5a3 3 0 0 0-3 3v12a3 3 0 0 0 3 3h15Zm-6.75-10.5a.75.75 0 0 0-1.5 0v2.25H9a.75.75 0 0 0 0 1.5h2.25v2.25a.75.75 0 0 0 1.5 0v-2.25H15a.75.75 0 0 0 0-1.5h-2.25V10.5Z" clip-rule="evenodd"></path></svg> Add to playlist</button></li> <li><button class="w-full text-left"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-[1.2em] inline mr-2 ml-4"><path fill-rule="evenodd" d="M19.902 4.098a3.75 3.75 0 0 0-5.304 0l-4.5 4.5a3.75 3.75 0 0 0 1.035 6.037.75.75 0 0 1-.646 1.353 5.25 5.25 0 0 1-1.449-8.45l4.5-4.5a5.25 5.25 0 1 1 7.424 7.424l-1.757 1.757a.75.75 0 1 1-1.06-1.06l1.757-1.757a3.75 3.75 0 0 0 0-5.304Zm-7.389 4.267a.75.75 0 0 1 1-.353 5.25 5.25 0 0 1 1.449 8.45l-4.5 4.5a5.25 5.25 0 1 1-7.424-7.424l1.757-1.757a.75.75 0 1 1 1.06 1.06l-1.757 1.757a3.75 3.75 0 1 0 5.304 5.304l4.5-4.5a3.75 3.75 0 0 0-1.035-6.037.75.75 0 0 1-.354-1Z" clip-rule="evenodd"></path></svg> Share</button></li> <li><button class="w-full text-left text-blue-500 dark:text-blue-400"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-[1.2em] inline mr-2 ml-4"><path fill-rule="evenodd" d="M19.902 4.098a3.75 3.75 0 0 0-5.304 0l-4.5 4.5a3.75 3.75 0 0 0 1.035 6.037.75.75 0 0 1-.646 1.353 5.25 5.25 0 0 1-1.449-8.45l4.5-4.5a5.25 5.25 0 1 1 7.424 7.424l-1.757 1.757a.75.75 0 1 1-1.06-1.06l1.757-1.757a3.75 3.75 0 0 0 0-5.304Zm-7.389 4.267a.75.75 0 0 1 1-.353 5.25 5.25 0 0 1 1.449 8.45l-4.5 4.5a5.25 5.25 0 1 1-7.424-7.424l1.757-1.757a.75.75 0 1 1 1.06 1.06l-1.757 1.757a3.75 3.75 0 1 0 5.304 5.304l4.5-4.5a3.75 3.75 0 0 0-1.035-6.037.75.75 0 0 1-.354-1Z" clip-rule="evenodd"></path></svg> Open song source</button></li></ul></div>',1);function js(n,e){Ne(e,!1);const t=()=>Ct(te,"$ViewInfo",r),[r,s]=xt(),o=async()=>{v.playback.appendQueue(t().select.track.meta,t().select.track.url),le(te,$(t).sheets.actions=!1,$(t))};On();var a=Ds(),l=me(a);l.__click=L=>{L.target==(L==null?void 0:L.currentTarget)&&le(te,$(t).sheets.actions=!1,$(t))};var c=C(l,2),d=C(k(c),2);d.__click=L=>{le(te,$(t).sheets.actions=!1,$(t))};var u=C(d,2),f=k(u),p=k(f);p.__click=()=>o();var m=C(f,2),S=k(m);S.__click=()=>le(te,$(t).sheets.selectPlaylist=!0,$(t));var T=C(m,4),q=k(T);q.__click=()=>{window.open(t().select.track.perma_url,"_blank")},F(1,c,()=>At,()=>({axis:"y",duration:300})),F(2,c,()=>At,()=>({axis:"y",duration:300})),E(n,a),Fe(),s()}He(["click"]);var Ls=z('<li><button class="m-0 p-0 text-left text-current leading-[25px] text-[20px] font-semibold"> </button></li>'),As=z(`<li class="dark:text-white/50 text-black/80">Currently not available. You can contribute lyrics through <a class="dark:text-blue-400 text-blue-600 after:content-['_']" href="https://lrclib.net/" target="_blank">LRCLIB</a></li>`),Os=z('<div class="relative w-[95dvw] h-fit p-2 pb-0 rounded-t-md overflow-hidden mt-5 text-white dark:text-white"><h3 class="text-xl">Lyrics <span class="text-[8px] text-white/80 bg-white/5 p-0.5 rounded-xs">Powered by LRCLIB</span></h3> <div class="absolute w-full h-[20px] left-0"></div> <ul class="max-h-[75dvh] px-2 space-y-2 overflow-y-scroll py-[20px]"></ul> <div class="absolute w-full h-[20px] bottom-0 left-0"></div></div>');function $s(n,e){Ne(e,!0);let t=gt(e,"time",11,0),r=we(void 0),s=we(Te({}));je(()=>{t();const d=document.getElementById("current-lyric");b(r)!=d&&d&&(Math.abs(d.getBoundingClientRect().y-b(s).clientTop-b(s).clientHeight/2)<250&&d.scrollIntoView({behavior:"smooth",block:"center"}),he(r,d,!0))});var o=Os(),a=C(k(o),2),l=C(a,2);nt(l,21,()=>e.content,st,(d,u,f)=>{const p=Ie(()=>{var q;return t()>=b(u).time&&t()<((q=e.content[f+1])==null?void 0:q.time)||0});var m=Ls(),S=k(m);S.__click=()=>{e.handleSeek(b(u).time)};var T=k(S);re(()=>{ve(m,1,Sn(b(p)?"":"text-white/30")),qe(S,"id",b(p)?"current-lyric":""),ce(T,b(u).text)}),E(d,m)},d=>{var u=As();E(d,u)}),vr(l,d=>he(s,d),()=>b(s));var c=C(l,2);re(()=>{Pe(o,`background-color: ${e.color??""};`),Pe(a,`background: linear-gradient(to bottom, ${e.color??""}, ${e.color??""}00);`),Pe(c,`background: linear-gradient(to top, ${e.color??""}, ${e.color??""}00);`)}),E(n,o),Fe()}He(["click"]);var zs=z('<button><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><!></svg> </button>'),Bs=z('<div class="h-[10dvh] text-xs w-dvw bg-black/5 dark:bg-white/5 rounded-t-md backdrop-brightness-80 dark:backdrop-brightness-20 backdrop-blur-lg flex flex-row items-start justify-center overflow-hidden"></div>');function qs(n,e){Ne(e,!0);const t=()=>Ct(te,"$ViewInfo",r),[r,s]=xt();var o=Bs();nt(o,21,()=>Object.keys(e.tab.views),st,(a,l)=>{var c=zs();c.__click=()=>{e.switchView(b(l))};var d=k(c),u=k(d);Ge(u,()=>t().tab==b(l)?e.tab.views[b(l)].path.selected:e.tab.views[b(l)].path.default,!0);var f=C(d);re(()=>{ve(c,1,`w-full flex flex-col items-center justify-center ${t().tab==b(l)?"text-violet-600 dark:text-violet-500 font-medium":""}`),ve(d,0,`size-7 ${t().tab==b(l)?"fill-current":"stroke-current stroke-[1.5px] fill-none"}`),ce(f,` ${b(l)??""}`)}),E(a,c)}),F(3,o,()=>ct,()=>({duration:500,y:100})),E(n,o),Fe(),s()}He(["click"]);var Us=z('<meta property="theme-color" content="#000" class="svelte-q4zhrl"/>'),Ns=z('<div class="backdrop-blur-lg backdrop-brightness-40 absolute top-0 left-0 h-full w-full flex flex-col items-center justify-center svelte-q4zhrl"><h1 class="text-2xl font-medium text-center mt-8 svelte-q4zhrl"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-[1em] mr-2 animate-spin inline svelte-q4zhrl" style="animation-duration: 750ms;"><path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99" class="svelte-q4zhrl"></path></svg>Loading...</h1> <p class="text-black/80 dark:text-white/50 text-center text-sm max-w-[75%] svelte-q4zhrl">Svara loads pages on-demand, so you only get what you need</p></div>'),Fs=z('<div class="h-full bg-black/20 dark:bg-white/20 absolute svelte-q4zhrl"></div>'),Vs=z('<img alt="song thumbnail" id="player-thumbnail" class="h-[6dvh] aspect-square rounded-md col-span-2 text-xs svelte-q4zhrl"/>'),Hs=z('<button class="p-0 m-0 col-span-8 pl-2 svelte-q4zhrl"><p class="font-medium text-md text-left truncate svelte-q4zhrl"><!> <span class="font-normal text-sm text-black/80 dark:text-white/80 block svelte-q4zhrl"><!></span></p></button>'),Js=Ve('<path fill-rule="evenodd" d="M6.75 5.25a.75.75 0 0 1 .75-.75H9a.75.75 0 0 1 .75.75v13.5a.75.75 0 0 1-.75.75H7.5a.75.75 0 0 1-.75-.75V5.25Zm7.5 0A.75.75 0 0 1 15 4.5h1.5a.75.75 0 0 1 .75.75v13.5a.75.75 0 0 1-.75.75H15a.75.75 0 0 1-.75-.75V5.25Z" clip-rule="evenodd" class="svelte-q4zhrl"></path>'),Zs=Ve('<path fill-rule="evenodd" d="M4.5 5.653c0-1.427 1.529-2.33 2.779-1.643l11.54 6.347c1.295.712 1.295 2.573 0 3.286L7.28 19.99c-1.25.687-2.779-.217-2.779-1.643V5.653Z" clip-rule="evenodd" class="svelte-q4zhrl"></path>'),Gs=z('<div id="miniplayer"><div class="h-[2px] inset-0 w-full bg-black/5 dark:bg-white/5 absolute top-0 rounded-full overflow-hidden svelte-q4zhrl"><!> <div class="h-full bg-red-500 dark:bg-red-900 absolute z-10 svelte-q4zhrl"></div></div> <!> <div class="grid grid-cols-10 svelte-q4zhrl"><!> <button class="p-0 m-0 col-span-1 svelte-q4zhrl"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-full mr-[1ch] svelte-q4zhrl"><!></svg></button> <button class="p-0 m-0 col-span-1 disabled:text-black/25 dark:disabled:text-white/25 svelte-q4zhrl" aria-label="next song"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-full mr-[1ch] svelte-q4zhrl"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd" class="svelte-q4zhrl"></path></svg></button></div></div>'),Ys=z('<div class="h-full bg-black/20 dark:bg-white/20 absolute svelte-q4zhrl"></div>'),Ws=Ve('<path fill-rule="evenodd" d="M6.75 5.25a.75.75 0 0 1 .75-.75H9a.75.75 0 0 1 .75.75v13.5a.75.75 0 0 1-.75.75H7.5a.75.75 0 0 1-.75-.75V5.25Zm7.5 0A.75.75 0 0 1 15 4.5h1.5a.75.75 0 0 1 .75.75v13.5a.75.75 0 0 1-.75.75H15a.75.75 0 0 1-.75-.75V5.25Z" clip-rule="evenodd" class="svelte-q4zhrl"></path>'),Ks=Ve('<path fill-rule="evenodd" d="M4.5 5.653c0-1.427 1.529-2.33 2.779-1.643l11.54 6.347c1.295.712 1.295 2.573 0 3.286L7.28 19.99c-1.25.687-2.779-.217-2.779-1.643V5.653Z" clip-rule="evenodd" class="svelte-q4zhrl"></path>'),Xs=z('<div class="absolute top-0 left-0 w-dvw h-dvh backdrop-blur-lg overflow-y-scroll no-scrollbar svelte-q4zhrl"><div class="w-full flex flex-col items-center relative svelte-q4zhrl"><div class="flex flex-row justify-between w-full py-[2.5dvw] px-[2.5dvw] sticky top-0 bg-white/50 dark:bg-zinc-900/50 backdrop-blur-md z-10 svelte-q4zhrl"><button aria-label="close sheet" class="p-0 m-0 svelte-q4zhrl"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="size-7 dark:fill-white/50 fill-black/50 svelte-q4zhrl"><path fill-rule="evenodd" d="M5.47 5.47a.75.75 0 0 1 1.06 0L12 10.94l5.47-5.47a.75.75 0 1 1 1.06 1.06L13.06 12l5.47 5.47a.75.75 0 1 1-1.06 1.06L12 13.06l-5.47 5.47a.75.75 0 0 1-1.06-1.06L10.94 12 5.47 6.53a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" class="svelte-q4zhrl"></path></svg></button><button aria-label="close sheet" class="p-0 m-0 svelte-q4zhrl"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="size-7 dark:fill-white/50 fill-black/50 svelte-q4zhrl"><path fill-rule="evenodd" d="M10.5 6a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Zm0 6a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Zm0 6a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Z" clip-rule="evenodd" class="svelte-q4zhrl"></path></svg></button></div> <div class="w-[80dvw] max-w-[500px] max-h-[70dvh] rounded-md mt-[10dvh] overflow-hidden flex items-center justify-center svelte-q4zhrl"><img alt="song thumbnail" class="w-full h-full object-contain rounded-md shadow-white dark:shadow-black shadow-xs svelte-q4zhrl"/></div> <div class="-space-y-1 mt-4 px-[2.5dvw] flex flex-col items-center svelte-q4zhrl"><h1 class="text-2xl font-bold line-clamp-1 svelte-q4zhrl"><!></h1> <p class="svelte-q4zhrl"><span class="text-black/50 dark:text-white/50 svelte-q4zhrl">by</span> <!></p></div> <div class="mt-12 svelte-q4zhrl"><div class="h-10 flex flex-col justify-center w-min -my-3 svelte-q4zhrl" role="progressbar"><div><!> <div class="h-full bg-red-500 dark:bg-red-900 absolute svelte-q4zhrl"></div></div></div> <div class="flex flex-row justify-between items-center text-sm svelte-q4zhrl"><p class="svelte-q4zhrl"> </p> <p class="svelte-q4zhrl"> </p></div></div> <div class="flex flex-row items-center justify-evenly w-[95dvw] mt-4 svelte-q4zhrl"><button aria-label="next song"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.75" stroke="currentColor" class="size-full svelte-q4zhrl"><path stroke-linecap="round" stroke-linejoin="round" d="M7.5 21 3 16.5m0 0L7.5 12M3 16.5h13.5m0-13.5L21 7.5m0 0L16.5 12M21 7.5H7.5" class="svelte-q4zhrl"></path></svg></button> <button class="p-0 m-0 w-8 disabled:text-black/25 dark:disabled:text-white/25 svelte-q4zhrl" aria-label="previous song"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-full svelte-q4zhrl"><path fill-rule="evenodd" d="M7.72 12.53a.75.75 0 0 1 0-1.06l7.5-7.5a.75.75 0 1 1 1.06 1.06L9.31 12l6.97 6.97a.75.75 0 1 1-1.06 1.06l-7.5-7.5Z" clip-rule="evenodd" class="svelte-q4zhrl"></path></svg></button> <button class="p-0 m-0 w-12 svelte-q4zhrl"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-full svelte-q4zhrl"><!></svg></button> <button class="p-0 m-0 w-8 disabled:text-black/25 dark:disabled:text-white/25 svelte-q4zhrl" aria-label="next song"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-full svelte-q4zhrl"><path fill-rule="evenodd" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z" clip-rule="evenodd" class="svelte-q4zhrl"></path></svg></button> <button aria-label="next song"><svg xmlns="http://www.w3.org/2000/svg" fill="none" class="size-full svelte-q4zhrl" viewBox="0 0 24 24" stroke-width="1.75" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 12c0-1.232-.046-2.453-.138-3.662a4.006 4.006 0 0 0-3.7-3.7 48.678 48.678 0 0 0-7.324 0 4.006 4.006 0 0 0-3.7 3.7c-.017.22-.032.441-.046.662M19.5 12l3-3m-3 3-3-3m-12 3c0 1.232.046 2.453.138 3.662a4.006 4.006 0 0 0 3.7 3.7 48.656 48.656 0 0 0 7.324 0 4.006 4.006 0 0 0 3.7-3.7c.017-.22.032-.441.046-.662M4.5 12l3 3m-3-3-3 3" class="svelte-q4zhrl"></path></svg></button></div> <!></div></div>'),Qs=z('<div class="absolute top-0 h-dvh w-dvw bg-transparent svelte-q4zhrl"><div class="absolute top-0 w-full h-full backdrop-brightness-40 pointer-events-none svelte-q4zhrl"></div> <!></div>'),ei=z('<div class="w-[100dwv] h-dvh bg-white dark:bg-black text-black dark:text-white svelte-q4zhrl"><!> <!>  <div class="absolute h-[15dvh] -bottom-[0dvh] w-screen bg-linear-to-b from-white/0 dark:from-black/0 to-40% to-white dark:to-black svelte-q4zhrl"></div> <div class="absolute max-h-[19dvh] space-y-[1dvh] w-screen -bottom-[0dvh] flex flex-col items-center svelte-q4zhrl"><!> <!></div> <!> <!> <!></div>');function ti(n,e){Ne(e,!0);const t=()=>Ct(te,"$ViewInfo",r),[r,s]=xt();let[o,a]=En({}),l=gt(e,"jamInfo",19,()=>({create:!0})),c=Te({initial:0,current:0,is:!1,startX:0,clientWidth:0}),d=we(Te(t().sheets.track));vt(()=>{u(at.search);const y=Tn("track",()=>{le(te,$(t).sheets.track=!1,$(t))});je(()=>{t().sheets.track!==b(d)&&(y(t().sheets.track),he(d,t().sheets.track,!0))})});const u=async y=>{y in f.views&&(f.views[y].component||(f.loading=!0,f.views[y].component=await f.views[y].loader(),f.loading=!1),le(te,$(t).tab=y,$(t)))};let f=Te({loading:!1,views:{[at.search]:{loader:()=>It(()=>import("./Search-CXbQjmus.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10])),path:{default:`<path stroke-linecap="round" stroke-linejoin="round" d="m15.75 15.75-2.489-2.489m0 0a3.375 3.375 0 1 0-4.773-4.773 3.375 3.375 0 0 0 4.774 4.774ZM21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
`,selected:`<path
              d="M8.25 10.875a2.625 2.625 0 1 1 5.25 0 2.625 2.625 0 0 1-5.25 0Z"
            />
            <path
              fill-rule="evenodd"
              d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25Zm-1.125 4.5a4.125 4.125 0 1 0 2.338 7.524l2.007 2.006a.75.75 0 1 0 1.06-1.06l-2.006-2.007a4.125 4.125 0 0 0-3.399-6.463Z"
              clip-rule="evenodd"
            />`}},[at.library]:{loader:()=>It(()=>import("./Library-BRgjLK7T.js"),__vite__mapDeps([11,1,2,4,5,3,6,7,8,9,10])),path:{default:`
  <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 0 0 6 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 0 1 6 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 0 1 6-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0 0 18 18a8.967 8.967 0 0 0-6 2.292m0-14.25v14.25" />
`,selected:`<path
            d="M11.25 4.533A9.707 9.707 0 0 0 6 3a9.735 9.735 0 0 0-3.25.555.75.75 0 0 0-.5.707v14.25a.75.75 0 0 0 1 .707A8.237 8.237 0 0 1 6 18.75c1.995 0 3.823.707 5.25 1.886V4.533ZM12.75 20.636A8.214 8.214 0 0 1 18 18.75c.966 0 1.89.166 2.75.47a.75.75 0 0 0 1-.708V4.262a.75.75 0 0 0-.5-.707A9.735 9.735 0 0 0 18 3a9.707 9.707 0 0 0-5.25 1.533v16.103Z"
          />`}},[at.settings]:{loader:()=>It(()=>import("./Settings-Difb9jFR.js"),__vite__mapDeps([12,1,2,10,7,3,8,9,6,5])),path:{default:`
  <path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z" />
  <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
`,selected:`<path
            fill-rule="evenodd"
            d="M11.078 2.25c-.917 0-1.699.663-1.85 1.567L9.05 4.889c-.02.12-.115.26-.297.348a7.493 7.493 0 0 0-.986.57c-.166.115-.334.126-.45.083L6.3 5.508a1.875 1.875 0 0 0-2.282.819l-.922 1.597a1.875 1.875 0 0 0 .432 2.385l.84.692c.095.078.17.229.154.43a7.598 7.598 0 0 0 0 1.139c.015.2-.059.352-.153.43l-.841.692a1.875 1.875 0 0 0-.432 2.385l.922 1.597a1.875 1.875 0 0 0 2.282.818l1.019-.382c.115-.043.283-.031.45.082.312.214.641.405.985.57.182.088.277.228.297.35l.178 1.071c.151.904.933 1.567 1.85 1.567h1.844c.916 0 1.699-.663 1.85-1.567l.178-1.072c.02-.12.114-.26.297-.349.344-.165.673-.356.985-.57.167-.114.335-.125.45-.082l1.02.382a1.875 1.875 0 0 0 2.28-.819l.923-1.597a1.875 1.875 0 0 0-.432-2.385l-.84-.692c-.095-.078-.17-.229-.154-.43a7.614 7.614 0 0 0 0-1.139c-.016-.2.059-.352.153-.43l.84-.692c.708-.582.891-1.59.433-2.385l-.922-1.597a1.875 1.875 0 0 0-2.282-.818l-1.02.382c-.114.043-.282.031-.449-.083a7.49 7.49 0 0 0-.985-.57c-.183-.087-.277-.227-.297-.348l-.179-1.072a1.875 1.875 0 0 0-1.85-1.567h-1.843ZM12 15.75a3.75 3.75 0 1 0 0-7.5 3.75 3.75 0 0 0 0 7.5Z"
            clip-rule="evenodd"
          />`}}}});vt(()=>{const y=Date.now();Object.keys(localStorage).forEach(P=>{P.startsWith("cache-search-")&&JSON.parse(localStorage.getItem(P)).expiry<y&&localStorage.removeItem(P)})});var p=ei();Mn("q4zhrl",y=>{var P=Us();Rn(D=>{wn.title=`${D??""} - Svara`},[()=>ds.capitalize(t().tab)]),E(y,P)});var m=k(p);nt(m,17,()=>Object.keys(f.views),st,(y,P)=>{var D=We(),w=me(D);{var B=V=>{const U=Ie(()=>f.views[b(P)].component);var H=We(),K=me(H);Pn(K,()=>b(U).default,(N,G)=>{G(N,{})}),E(V,H)};Z(w,V=>{f.views[b(P)].component&&V(B)})}E(y,D)});var S=C(m,2);{var T=y=>{var P=Ns();F(3,P,()=>Re,()=>({duration:150,delay:100})),E(y,P)};Z(S,y=>{f.loading&&y(T)})}var q=C(S,4),L=k(q);{var x=y=>{var P=Gs(),D=k(P),w=k(D);{var B=J=>{var j=Fs();re(()=>Pe(j,`width: ${v.info.fetch??""}%;`)),E(J,j)};Z(w,J=>{v.info.fetch!=0&&J(B)})}var V=C(w,2),U=C(D,2);{var H=J=>{var j=Vs();re(()=>qe(j,"src",v.info.meta.img)),F(2,j,()=>o,()=>({key:"player-thumbnail"})),F(1,j,()=>a,()=>({key:"player-thumbnail",duration:300})),E(J,j)};Z(U,J=>{t().sheets.track||J(H)})}var K=C(U,2),N=k(K);{var G=J=>{var j=Hs();j.__click=()=>{le(te,$(t).sheets.track=!0,$(t))};var ee=k(j),se=k(ee);Ge(se,()=>v.info.meta.title);var ke=C(se,2),Me=k(ke);Ge(Me,()=>v.info.meta.artist),F(2,ke,()=>o,()=>({key:"player-artist"})),F(1,ke,()=>a,()=>({key:"player-artist",duration:300})),F(2,ee,()=>o,()=>({key:"player-title"})),F(1,ee,()=>a,()=>({key:"player-title",duration:300})),E(J,j)};Z(N,J=>{t().sheets.track||J(G)})}var oe=C(N,2);oe.__click=()=>{v.info.playing?v.playback.pause():v.playback.resume()};var ue=k(oe),Q=k(ue);{var fe=J=>{var j=Js();F(3,j,()=>Re,()=>({duration:150})),E(J,j)},ge=J=>{var j=Zs();F(3,j,()=>Re,()=>({duration:150})),E(J,j)};Z(Q,J=>{v.info.playing?J(fe):J(ge,!1)})}var _e=C(oe,2);_e.__click=()=>{v.playback.next()},re(()=>{ve(P,1,`h-[8dvh] w-[95dvw] ring-1 ring-black/10 dark:ring-white/10 bg-black/5 dark:bg-white/5 rounded-md backdrop-brightness-80 dark:backdrop-brightness-20 backdrop-blur-lg flex flex-row items-center px-[0.5dvh] pt-[0.5dvh] border-t border-white/5 dark:border-white/5 overflow-hidden ${v.info.playing?"":"anim-pause"}`,"svelte-q4zhrl"),Pe(V,`width: ${v.info.t/v.info.dur*100}%;`),_e.disabled=v.info.queue.length-1<=v.info.qi}),F(3,D,()=>Re,()=>({duration:250})),E(y,P)};Z(L,y=>{v.info.init&&y(x)})}var A=C(L,2);qs(A,{get tab(){return f},switchView:u});var g=C(q,2);{var M=y=>{var P=Xs(),D=k(P),w=k(D),B=k(w);B.__click=()=>le(te,$(t).sheets.track=!1,$(t));var V=C(B);V.__click=()=>{le(te,$(t).sheets.actions=!0,$(t)),le(te,$(t).select.track=v.playback.getCurrent(),$(t))};var U=C(w,2),H=k(U),K=C(U,2),N=k(K),G=k(N);Ge(G,()=>v.info.meta.title);var oe=C(N,2),ue=C(k(oe),2);Ge(ue,()=>v.info.meta.artist);var Q=C(K,2),fe=k(Q);fe.__pointerdown=Y=>{c.is=!0,c.startX=Y.clientX,c.initial=v.info.t/v.info.dur},fe.__pointermove=Y=>{if(!c.is)return;const ie=Y.clientX-c.startX;c.current=Math.min(Math.max(c.initial+ie/c.clientWidth,0),1)},fe.__pointerup=Y=>{c.is=!1,v.playback.seekTo(c.current*v.info.dur)};var ge=k(fe),_e=k(ge);{var J=Y=>{var ie=Ys();re(()=>Pe(ie,`width: ${v.info.fetch??""}%;`)),E(Y,ie)};Z(_e,Y=>{v.info.fetch!=0&&Y(J)})}var j=C(_e,2),ee=C(fe,2),se=k(ee),ke=k(se),Me=C(se,2),ln=k(Me),Xt=C(Q,2),St=k(Xt);St.__click=()=>{v.info.controls.shuffle=!v.info.controls.shuffle};var Tt=C(St,2);Tt.__click=()=>{v.playback.previous()};var Rt=C(Tt,2);Rt.__click=()=>{v.info.playing?v.playback.pause():v.playback.resume()};var dn=k(Rt),un=k(dn);{var fn=Y=>{var ie=Ws();F(3,ie,()=>Re,()=>({duration:150})),E(Y,ie)},pn=Y=>{var ie=Ks();F(3,ie,()=>Re,()=>({duration:150})),E(Y,ie)};Z(un,Y=>{v.info.playing?Y(fn):Y(pn,!1)})}var Pt=C(Rt,2);Pt.__click=()=>{v.playback.next()};var Qt=C(Pt,2);Qt.__click=()=>{v.info.controls.loop=!v.info.controls.loop};var hn=C(Xt,2);{var mn=Y=>{$s(Y,{get color(){return v.info.meta.colors.primary},get content(){return v.info.meta.lyrics.content},handleSeek:ie=>{v.info.audioElm.currentTime=ie},get time(){return v.info.t},set time(ie){v.info.t=ie}})};Z(hn,Y=>{v.info.meta.lyrics&&Y(mn)})}re((Y,ie)=>{Pe(P,`background-color: ${v.info.meta.colors.secondary??""}85;`),qe(H,"src",v.info.meta.img),ve(ge,1,`${c.is?"h-[10px]":"min-h-[5px]"} w-[95dvw] bg-black/5 dark:bg-white/5 rounded-full overflow-hidden relative transition-transform duration-200`,"svelte-q4zhrl"),Pe(j,`width: ${c.is?c.current*100:v.info.t/v.info.dur*100}%;`),ce(ke,Y),ce(ln,ie),ve(St,1,`p-0 m-0 w-6 ${v.info.controls.shuffle?"text-violet-500 dark:text-violet-600":""}`,"svelte-q4zhrl"),Tt.disabled=v.info.qi<1,Pt.disabled=v.info.queue.length-1<=v.info.qi,ve(Qt,1,`p-0 m-0 w-6 ${v.info.controls.loop?"text-violet-500 dark:text-violet-600":""}`,"svelte-q4zhrl")},[()=>new Date(c.is?c.current*v.info.dur*1e3:v.info.t*1e3).toISOString().slice(14,19),()=>new Date(v.info.dur*1e3).toISOString().slice(14,19)]),F(2,H,()=>o,()=>({key:"player-thumbnail"})),F(1,H,()=>a,()=>({key:"player-thumbnail",duration:500})),F(2,N,()=>o,()=>({key:"player-title"})),F(1,N,()=>a,()=>({key:"player-title",duration:300})),F(2,oe,()=>o,()=>({key:"player-artist"})),F(1,oe,()=>a,()=>({key:"player-artist",duration:300})),An(ge,"clientWidth",Y=>c.clientWidth=Y),F(1,P,()=>ct,()=>({duration:400,y:750})),F(2,P,()=>ct,()=>({duration:400,y:750})),E(y,P)};Z(g,y=>{t().sheets.track&&y(M)})}var O=C(g,2);{var X=y=>{var P=Qs(),D=k(P),w=C(D,2);{var B=U=>{Is(U,{})},V=U=>{var H=We(),K=me(H);{var N=G=>{js(G,{})};Z(K,G=>{t().sheets.actions&&G(N)},!0)}E(U,H)};Z(w,U=>{t().sheets.selectPlaylist?U(B):U(V,!1)})}F(1,D,()=>Re,()=>({duration:200})),F(2,D,()=>Re,()=>({duration:200})),E(y,P)};Z(O,y=>{(t().sheets.actions||t().sheets.selectPlaylist)&&y(X)})}var R=C(O,2);Ss(R,{get info(){return l()},get visible(){return t().sheets.jam},set visible(y){le(te,$(t).sheets.jam=y,$(t))}}),F(3,q,()=>ct,()=>({duration:250,y:100})),E(n,p),Fe(),s()}He(["click","pointerdown","pointermove","pointerup"]);const fi=Object.freeze(Object.defineProperty({__proto__:null,default:ti},Symbol.toStringTag,{value:"Module"}));export{fi as D,Ze as c,On as i,ui as l,v as u};
